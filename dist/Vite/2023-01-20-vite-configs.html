<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite 配置项讲解 | Big Rice 🍚</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Vite 一些常用的配置项的作用笔记">
    
    <link rel="preload" href="/bigRiceRice.io/dist/assets/css/0.styles.07d2ad69.css" as="style"><link rel="preload" href="/bigRiceRice.io/dist/assets/js/app.e40e56d4.js" as="script"><link rel="preload" href="/bigRiceRice.io/dist/assets/js/6.4adeed80.js" as="script"><link rel="preload" href="/bigRiceRice.io/dist/assets/js/12.568a4166.js" as="script"><link rel="preload" href="/bigRiceRice.io/dist/assets/js/93.40a27a87.js" as="script"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/10.5590a827.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/11.168de83c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/13.e940090d.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/14.dc0bcdc3.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/15.d1d3e4db.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/16.ebeb32bf.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/17.c3dd4d0c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/18.f866ec42.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/19.b1cb79cd.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/20.5be10f1b.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/21.9d4d5a4c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/22.c3add0f7.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/23.4de16fde.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/24.471429ef.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/25.3a1e5f8f.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/26.f7beff95.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/27.0853cfce.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/28.ee76b4d9.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/29.cbfc2db4.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/3.2a259be5.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/30.07a7e574.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/31.bbd098e3.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/32.ead5b9a7.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/33.37495d61.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/34.be3ea514.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/35.e69c119d.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/36.567f1f05.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/37.31e20c86.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/38.b0925063.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/39.f588d93f.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/4.cb5dc486.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/40.9348ddae.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/41.3f59a68b.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/42.437e7888.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/43.65f0a71a.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/44.b69b697f.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/45.6368e269.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/46.2c134927.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/47.aa7eacac.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/48.2cf1db2b.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/49.4d7bf943.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/5.44ec780a.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/50.ad5e5ae9.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/51.5808d818.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/52.9cf1cb74.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/53.506fdaeb.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/54.2b22996a.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/55.5231db92.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/56.fb63a532.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/57.b1ab4ac7.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/58.1f35c496.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/59.4c13ca5c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/60.dd86caec.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/61.10bdb60c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/62.79bd5628.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/63.c1e64965.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/64.0844e861.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/65.d83ee281.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/66.912efc81.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/67.264e33aa.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/68.471581d3.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/69.d2cc646e.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/7.a918f9c2.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/70.39b927a0.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/71.35eabcc2.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/72.f98b9f33.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/73.d5ba8d76.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/74.1eb2ee3c.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/75.9b097318.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/76.96abd87e.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/77.a79060a6.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/78.0d34317d.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/79.bc097473.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/8.45199285.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/80.69352813.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/81.81cb0786.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/82.f9e415e6.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/83.c47b3520.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/84.26b7d911.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/85.7204efd5.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/86.10900b48.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/87.101df704.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/88.f98c1d02.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/89.488a74f0.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/9.2eadd3a5.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/90.cbae52bc.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/91.39790983.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/92.215a930e.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/94.28fd71ca.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/95.7545f6b2.js"><link rel="prefetch" href="/bigRiceRice.io/dist/assets/js/vuejs-paginate.bd98283b.js">
    <link rel="stylesheet" href="/bigRiceRice.io/dist/assets/css/0.styles.07d2ad69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/bigRiceRice.io/dist/" class="nav-link home-link">Big Rice 🍚 </a> <button class="back" style="display:;">↩</button></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/bigRiceRice.io/dist/FrameWork/" class="nav-link">框架</a></li><li class="nav-item"><a href="/bigRiceRice.io/dist/Css/" class="nav-link">Css</a></li><li class="nav-item"><a href="/bigRiceRice.io/dist/API/" class="nav-link">API</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/bigRiceRice.io/dist/" class="nav-link mobile-home-link">Big Rice 🍚 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/bigRiceRice.io/dist/FrameWork/" class="nav-link">框架</a></li><li class="mobile-nav-item"><a href="/bigRiceRice.io/dist/Css/" class="nav-link">Css</a></li><li class="mobile-nav-item"><a href="/bigRiceRice.io/dist/API/" class="nav-link">API</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h2 id="css-预处理-模块化配置"><a href="#css-预处理-模块化配置" class="header-anchor">#</a> CSS 预处理 &amp; 模块化配置</h2> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <h4 id="对-css-的默认处理"><a href="#对-css-的默认处理" class="header-anchor">#</a> 对 Css 的默认处理</h4> <p>Vite 对 css 文件的支持是开箱即用的，在 js 文件中直接导入一个 css 文件会<strong>直接生效</strong>，内部处理的流程大致如下：</p> <ol><li>Vite 读取到 js 脚本文件中导入了 css 样式文件</li> <li>使用 fs 模块读取 css 文件内容</li> <li>新建一个 <code>&lt;style&gt;</code> 元素并将读取到的 css 文件内容插入</li> <li>将这个 <code>&lt;style&gt;</code> 元素插入到 index.html 中的 <code>&lt;head&gt;</code> 下</li> <li>将 css 文件的内容替换为 js 脚本，以方便热更新</li></ol> <blockquote><p>浏览器读取文件的内容其实不关是看文件的后缀名，影响读取方式<strong>权重最大</strong>的是看 <code>Content-Type</code> 标头的取值，只要 <code>Content-Type</code> 的值为 <code>text/javascript</code> 那么无论后缀名是啥，都会把它当作 js 脚本。</p></blockquote> <h4 id="预处理器支持"><a href="#预处理器支持" class="header-anchor">#</a> 预处理器支持</h4> <p>我们都知道，若一个原始的 html 文件想要使用 less、scss 等预处理器工具，直接导入也是无效的，必须先手动的编译生成 css 文件后才能正常引入。</p> <p>而 Vite 对预处理器支持也是非常顶的 🤙，只需要安装对应的预处理包即可，正常使用的话任何额外配置项都不需要！</p> <h4 id="后处理器支持"><a href="#后处理器支持" class="header-anchor">#</a> 后处理器支持</h4> <p>这里所说的“后处理器”指的是 Postcss，相信很多人跟我一样，经常能在各种项目中看到 Postcss 的身影，却不知道它的具体用处何在。</p> <p>简单来说，Postcss 与 Babel 非常类似，它同样用于完成 Css 代码的降级，语法的兼容，那么为何称它为“<strong>后</strong>”处理器呢？</p> <p>因为它与 less、sass 这类预处理器有着本质的不同：即 Postcss 的输入与输出产物都是 css 文件。因此，Postcss 也被成为**「后处理器」<strong>，因为其通常在 css 处理链条的</strong>最后端**。</p> <p>而在 Vite 中也对 Postcss 有着良好的支持 🤟。</p> <h4 id="模块化支持"><a href="#模块化支持" class="header-anchor">#</a> 模块化支持</h4> <p>假如有很多的模块都需要使用同一个样式文件，项目庞大后，难免会造成样式污染影响到开发，值得庆幸的是，Vite 很好地支持 <em>CssModule</em>（Css 模块化）。</p> <p>在 Vite 项目中若要开启一个 css 文件的模块化，那么它的文件后缀<strong>必须</strong>为 <code>.module.css</code> ，这之后就可以在 js 文件中导入使用了。</p> <blockquote><p>正常情况下 js 脚本中是无法引入 css 样式文件的，Vite 项目中可以引入都是 Vite 底层自动的帮我们处理好了。</p></blockquote> <p>我们可以在 Vite 项目中创建一个 <code>index.module.css</code> 随后导入看看效果：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* index.module.css */</span>
<span class="token selector">.new-div1,
.new-div2</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> bisque<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.new-div2</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> gold<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>随后在 main.js 中导入并打印输出：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> s1 <span class="token keyword">from</span> <span class="token string">&quot;./styles/s1.module.css&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s1&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301251513595.png" alt="image-20230125151342515"></p> <p>可以看到，我们在 js 导入了 css 文件非但没有报错，且 css 文件还给我们导出了东西。</p> <p>我们可以再看看 style 标签与服务器响应的 index.module.css 的文件内容：</p> <p>style 标签内容：</p> <p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301251517107.png" alt="image-20230125151748047"></p> <p>index.module.css 文件内容：</p> <p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301251519438.png" alt="image-20230125151926364"></p> <p>正常情况下 js 脚本中是无法引入 css 样式文件的，这里可以引入都是 Vite 底层自动的帮我们处理好了。</p> <p>内部处理的流程大致如下：</p> <ol><li>Vite 读取到 js 脚本中导入了 CssModule 模块化样式表文件</li> <li>使用 fs 模块读取 CssModule 文件内容，并进行一定规则的替换，达到唯一性
<ul><li>比如将 <code>.footer-box</code> 替换为 <code>_footer_box_xxxx_f1</code></li></ul></li> <li>同时创建一个类名映射对象，比如 <code>{footer-box : &quot;_footer_box_xxxx_f1&quot;}</code></li> <li>新建一个 <code>&lt;style&gt;</code> 元素并将替换后的 CssModule 文件内容插入</li> <li>将这个 <code>&lt;style&gt;</code> 元素插入到 index.html 中的 <code>&lt;head&gt;</code> 下</li> <li>将 CssModule 文件的内容替换为 js 脚本，脚本的内容是一映射对象的默认导出与一些方便热更新的内容，最后设置 <code>Content-Type = &quot;text/javascript&quot;</code></li></ol> <h3 id="模块化配置项"><a href="#模块化配置项" class="header-anchor">#</a> 模块化配置项</h3> <p>假如你知道了 Vite 是默认支持 CssMoule 的，我们就可以了解一下几个配置项了，配置文件定义如下：</p> <blockquote><p>以下的配置项最后都将传给叫做 postcss-modules 的第三方包，Postcss 是 Css 后处理器，可以完成 Css 代码的语法降级，添加前缀等效果，而 postcss-modules 可以完成 Css 模块化</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 对 CSS 文件的打包结果进行配置</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对 CssModule 文件结果进行配置</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="modules-localsconvention"><a href="#modules-localsconvention" class="header-anchor">#</a> <em>modules.localsConvention</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>localsConvention<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'camelCase'</span> <span class="token operator">|</span> <span class="token string">'camelCaseOnly'</span> <span class="token operator">|</span> <span class="token string">'dashes'</span> <span class="token operator">|</span> <span class="token string">'dashesOnly'</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>originalClassName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> generatedClassName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> inputFile<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>localsConvention 配置项定义了 CssModule 文件中默认导出对象中 Key 的<strong>格式</strong>，取值为：</p> <ul><li><em>camelCase</em>：小驼峰写法
<ul><li><code>.test-demo--&gt; testDemo</code></li></ul></li> <li><em>camelCaseOnly</em>：只有小驼峰写法</li> <li><em>dashes</em>：短横线写法</li> <li><em>dashesOnly</em>：<strong>默认值</strong>，只有短横线写法</li> <li>或者自定义一个函数返回自定义映射关系</li></ul> <blockquote><p>Vite^4.0.4 版本中貌似有 BUG，只要 localsConvention 有值，那么<strong>都将会</strong>生产小驼峰的映射关系</p></blockquote> <h4 id="modules-generatescopedname"><a href="#modules-generatescopedname" class="header-anchor">#</a> <em>modules.generateScopedName</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>generateScopedName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> css<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>generateScopedName 配置项可以自定义生成唯一性类名替换的规则</p> <ul><li><em>string</em>：是一个 <em><a href="https://github.com/webpack/loader-utils#interpolatename" target="_blank" rel="noopener noreferrer">interpolateName<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em> 语法的占位符，它看起来像这样：<code>&quot;[local]_[hash:5]&quot;</code></li> <li>或者自定义一个规则函数</li></ul> <h4 id="modules-hashprefix"><a href="#modules-hashprefix" class="header-anchor">#</a> <em>modules.hashPrefix</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>hashPrefix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</code></pre></div><p>hashPrefix 配置项用于将默认规则中的哈希值变得更加独特（可重复性更小）。</p> <blockquote><p>该配置项用于给哈希值添加一个前缀，因为内部的规则是根据 <strong>文件名 + 哈希值 + 其他依据</strong> 生成的唯一类名，而哈希值的生成规则是<strong>字符串不同的越多，可重复性更小</strong>。</p></blockquote> <h4 id="modules-globalmodulepaths"><a href="#modules-globalmodulepaths" class="header-anchor">#</a> <em>modules.globalModulePaths</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code> globalModulePaths<span class="token operator">?</span><span class="token operator">:</span> RegExp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>globalModulePaths 配置项可以设置一些 CssModule 的文件路径，表示这些文件不参与到模块化类名替换中</p> <h3 id="预处理器配置项"><a href="#预处理器配置项" class="header-anchor">#</a> 预处理器配置项</h3> <p>知道了 Vite 良好的支持预处理器，我们就可以了解一下几个配置项了，配置文件定义如下：</p> <blockquote><p>以下的配置项最后都将传给 less &amp; sass 等第三方预处理工具</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 对 CSS 文件的打包结果进行配置</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对预处理器工具进行配置</span>
        <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sass</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// ...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>preprocessorOptions 中对预处理的配置需要查看官方文档来获知：<a href="https://less.bootcss.com/usage/#lessjs-options" target="_blank" rel="noopener noreferrer">less<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="">sass</a></p> <ul><li><p>比如 less 中的 <strong><em>lessc</em></strong> 编译指令是可以携带参数</p> <p>假设 <em>lessc</em> 命令是这样配置的：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>npx lessc <span class="token operator">--</span>math=<span class="token string">&quot;always&quot;</span> index<span class="token punctuation">.</span>less
</code></pre></div><p>那么在 vite 中就可以这样完成自动配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">less</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">math</span><span class="token operator">:</span> <span class="token string">&quot;always&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h4 id="less-globalvars"><a href="#less-globalvars" class="header-anchor">#</a> <em>less.globalVars</em></h4> <p>globalVars 配置项可以让我们在配置文件中直接定义 less 的全局变量</p> <p>假设我们在 globarVars 中定义了一个合法的 css 变量对象，那么在 less 文件中是可以直接使用的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">less</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">globalVars</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">color1</span><span class="token operator">:</span> <span class="token string">&quot;hsl(1,50%,50%)&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">color2</span><span class="token operator">:</span> <span class="token string">&quot;hsl(150,50%,50%)&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>less 文件内容：</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token comment">/* styles/s2.module.less */</span>
<span class="token selector">.less-div1,
.less-div2</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>500px <span class="token operator">/</span> 2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>500px <span class="token operator">/</span> 2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token variable">@color2</span><span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.less-div2</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token variable">@color1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>main.js 文件内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lessDiv1<span class="token punctuation">,</span> lessDiv2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./styles/s2.module.less&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> l1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> l2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

l1<span class="token punctuation">.</span>className <span class="token operator">=</span> lessDiv1<span class="token punctuation">;</span>
l2<span class="token punctuation">.</span>className <span class="token operator">=</span> lessDiv2<span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>效果：</p> <img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301251740423.png" alt="image-20230125174057365" style="zoom:50%;"> <blockquote><p>其实更好的做法是额外定义一个 js 文件定义全局变量后默认导出，再导入使用即可。</p></blockquote> <h3 id="devsourcemap"><a href="#devsourcemap" class="header-anchor">#</a> <em>devSourcemap</em></h3> <p>该配置项定义是否开启<strong>记录源文件索引地址</strong></p> <p>在我们的开发过程中，如果我们想查看某个样式的源文件在哪，是无法直接跳转的，而是会跳转到相应的 style 标签体中，而当我们配置了 devScurcemap 这个配置项后，就可以追踪到源文件的路径了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">devScurcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="postcss-配置项"><a href="#postcss-配置项" class="header-anchor">#</a> Postcss 配置项</h3> <p>在原生项目中，若需要加工处理 Css 代码，需要安装 <em>postcss 、postcss-cli</em> 两个包，随后调用类似 <code>npx postcss [filename].css -o out.css</code> 命令完成处理，而且配置项需写在 <code>postcss.config.js</code> 文件中，这非常的繁琐！</p> <p>而在 Vite 中，只需要填写 postcss 字段，即可完成 Postcss 的配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">postcss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>比如我们可以为 Postcss 添加一个预设（就跟 babel-parset-env 类似的预设），就可以自动的完成 Css 代码处理。</p> <p>首先下载 <code>postcss-parset-env</code> 包：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>yarn add postcss-preset-env
</code></pre></div><p>随后添加如下配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> postcssPresetEnv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;postcss-preset-env&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">postcss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">postcssPresetEnv</span><span class="token punctuation">(</span><span class="token comment">/* optins */</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>随后我们项目中所有的 Css 代码都将被自动加工处理 👋。</p> <p>比如我导入一个这样的样式文件：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* index.css */</span>
<span class="token selector">:root</span> <span class="token punctuation">{</span>
    <span class="token property">--color1</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>15<span class="token punctuation">,</span> 50%<span class="token punctuation">,</span> 50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>500px<span class="token punctuation">,</span> 50vw<span class="token punctuation">,</span> 70vw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么将会自动处理为如下：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* index.css */</span>
<span class="token selector">:root</span> <span class="token punctuation">{</span>
    <span class="token property">--color1</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>15<span class="token punctuation">,</span> 50%<span class="token punctuation">,</span> 50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
+   <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">hsl</span><span class="token punctuation">(</span>15<span class="token punctuation">,</span> 50%<span class="token punctuation">,</span> 50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">max</span><span class="token punctuation">(</span>500px<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>50vw<span class="token punctuation">,</span> 70vw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>
+   <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
+      <span class="token property">-moz-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="静态资源处理-路径别名"><a href="#静态资源处理-路径别名" class="header-anchor">#</a> 静态资源处理 &amp; 路径别名</h2> <h3 id="静态资源"><a href="#静态资源" class="header-anchor">#</a> 静态资源</h3> <p>Vite 中对任何的静态资源都是<strong>开箱即用</strong>的，无论你引入的是 <em>png &amp; jpeg &amp; jpg &amp; svg &amp; mp4 &amp; mp3 ...</em> 内容，Vite 都会默认将它转换为<strong>资源的相对路径</strong>，我们可以尝试引入资源：</p> <blockquote><p>在开发中，静态资源是狭义的图片、SVG、视频、.ico 等资源，而在服务器上，项目中 99% 的内容都是广义上的静态资源，除了需要动态获取的数据。</p></blockquote> <p>假设项目中有一个 src/assets/ 目录，现在它们的内容如下：</p> <div class="language- extra-class"><pre class="language-text"><code>src/assets
├─ images
│	├─ img1.jpg
│	└─ shield_icon.svg
└─ video1.mp4
</code></pre></div><p>随后定义一个 JS 文件导入文件后打印输入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @ 开头的目录为路径别名，需要在 viet.config.js 中配置</span>
<span class="token keyword">import</span> video1 <span class="token keyword">from</span> <span class="token string">&quot;@assets/video1.mp4&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;@images/shield_icon.svg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> img1 <span class="token keyword">from</span> <span class="token string">&quot;@images/img1.jpg&quot;</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;video1&quot;</span><span class="token punctuation">,</span> video1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; /src/assets/video1.mp4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;svg1&quot;</span><span class="token punctuation">,</span> svg1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; /src/assets/images/shield_icon.svg</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;img1&quot;</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; /src/assets/images/img1.jpg</span>
</code></pre></div><p>没错，会直接获取到指定文件的相对路径，因为 Vite 自动将资源的内容处理为 JS 脚本，并默认导出相对路径。其实它们的二进制内容已经被替换为 JS 脚本了：</p> <img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301271405751.png" alt="image-20230127140522677" style="zoom:67%;"> <p>所以我们就可以直接将路径用于 img &amp; video 标签的 src 属性上了，这就是对静态资源的开箱即用。</p> <p>那么其实这里有一个问题，就是导入的 svg 矢量图将如何显示？你可能知道可以直接使用 img 标签来导入 svg 的路径使用，这显然也是可行的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;@images/shield_icon.svg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> i1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
i1<span class="token punctuation">.</span>src <span class="token operator">=</span> svg1<span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301271412253.png" alt="image-20230127141203191" style="zoom:67%;"> <p>但这样我们就失去了 svg 图片的一些特性，比如修改颜色等。那么这个时候我们就可以传递一个 <code>raw</code> 参数，指定需要的是原始数据而非资源路径。</p> <h4 id="raw"><a href="#raw" class="header-anchor">#</a> <em>raw</em></h4> <p>我们可以通过在资源路径的最末尾加上 <code>?raw</code> 表示需要的是<strong>原始数据</strong>（二进制文本）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;@images/shield_icon.svg?raw&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> svg1<span class="token punctuation">;</span>
</code></pre></div><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301271520302.png" alt="image-20230127152044239" style="zoom:67%;"> <p>与之对应的是 <code>url</code> 参数，也就是默认值。</p> <h4 id="url"><a href="#url" class="header-anchor">#</a> <em>url</em></h4> <p>我们可以通过在资源路径的最末尾加上 <code>?url</code> 表示需要的是<strong>资源相对路径</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;@images/shield_icon.svg?url&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="路径别名"><a href="#路径别名" class="header-anchor">#</a> 路径别名</h3> <p>当我们遇到一个组件定义在很深的目录下，导致引用的层级变得非常烦人，在大型项目中甚至可能遇见 <code>../../../../src/assets/images/img.jpg</code> 这样的迷惑路径。</p> <p>那么<strong>路径别名</strong>可以很好的帮到你，它的功能就像 Moba 游戏中在指定位置中插一个眼，需要过去的时候再 <em>传送</em> 过去。</p> <p>路径别名的定义是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 配置别名，将会传递给 @rollup/plugin-alias 的 entries 配置</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// resolve 的返回值是一个绝对路径</span>
            <span class="token string-property property">&quot;@src&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../../src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;@assets&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../assets&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;@images&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../assets/images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>我们需要在 <code>resolve</code> 属性下定义一个名为 <code>alias</code> 的对象，此对象的 key 是一个唯一的标识符，value 是指定的真实资源路径。</p> <p>当我们定义好别名对象后，Vite 就会在打包时检查一遍所有资源的导入路径，若发现标识符 key ，则将它替换为 value。</p> <p><strong>value 路径需要注意的点：</strong></p> <ul><li>value 路径请始终使用<strong>绝对路径</strong>。相对路径的别名值会原封不动地被使用，因此无法被正常解析。
<ul><li>所以最好使用 <code>path</code> 模块的 <code>resolve</code> 方法来拼接，以消除<em>某些可能存在的 BUG 或不同操作系统下的兼容性</em>。</li></ul></li></ul> <p>当我们定义好路径别名后，在项目中就可以像这样使用了：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> video1 <span class="token keyword">from</span> <span class="token string">&quot;@assets/video1.mp4&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;@images/shield_icon.svg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> img1 <span class="token keyword">from</span> <span class="token string">&quot;@images/img1.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你打开浏览器查看真实生效的源代码，会发现以上代码会被替换为如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> video1 <span class="token keyword">from</span> <span class="token string">&quot;/src/assets/video1.mp4&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> svg1 <span class="token keyword">from</span> <span class="token string">&quot;/src/images/shield_icon.svg&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> img1 <span class="token keyword">from</span> <span class="token string">&quot;/src/images/img1.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="关于打包-打包配置"><a href="#关于打包-打包配置" class="header-anchor">#</a> 关于打包 &amp; 打包配置</h2> <h3 id="前言-2"><a href="#前言-2" class="header-anchor">#</a> 前言</h3> <h4 id="😮-打包后使用-live-serve-插件启动项目报错"><a href="#😮-打包后使用-live-serve-插件启动项目报错" class="header-anchor">#</a> 😮 打包后使用 live serve 插件启动项目报错</h4> <p>当我们执行 <code>yarn build</code> 后，会在根目录下生成一个 dist 目录，里面存放的是我们所有代码的压缩文件，以我的 Demo 为例，打包后的文件目录长这样：</p> <p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301272312014.png" alt="image-20230127231209938"></p> <p>此时直接在 index.html 启用一个 <code>live serve</code> 服务器，是无法正常的打开页面的，会提示 <code>404</code> 错误，这里的原因很简单，因为 <code>live serve</code> 插件默认是启用根据工程目录来启用服务器的，它的本地地址应该是这样的</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:60649/dist/index.html
</code></pre></div><p>而我们项目中的资源导入的地址是基于根目录的（即 127.0.0.1），而此时插件的本地服务器根目录是 dist，所以自然而然无法访问到资源，所以报错，解决方法也很简单：新建一个空的文件夹，将 dist 目录下的所有内容全部拷贝进去。再启用 <code>live serve</code> 就可以正常打开页面了。</p> <h4 id="😮-文件后的哈希乱码有何用处"><a href="#😮-文件后的哈希乱码有何用处" class="header-anchor">#</a> 😮 文件后的哈希乱码有何用处</h4> <p>你也肯定也注意到了，打包后除了 index.html 文件，所有文件的末尾都有一个 <code>-</code> 开头的哈希乱码，那么这串哈希乱码有何用处呢？</p> <p>简单来说，是一个利用哈希乱码的巧妙运用，旨在绕过浏览器引用缓存文件机制，达到更新文件。</p> <ul><li>浏览器文件缓存机制
<ul><li>浏览器为了减少性能占用，在第一次请求文件完成后，会将此文件丢到缓存去，那么下一次刷新后就可以直接利用缓存中的文件从而减少性能占用了。</li></ul></li> <li>哈希乱码生成规则
<ul><li>哈希乱码的生成根据内容而产生不同的结果，若传入的内容不变，那么生成的结果不变，若内容修改，结果修改。</li></ul></li></ul> <h3 id="打包配置"><a href="#打包配置" class="header-anchor">#</a> 打包配置</h3> <p>在 Vite 中，底层使用了 <em>rollup</em> 第三方包来完成小模块的打包。</p> <blockquote><p>rollup 提供一个充分利用 ESM 各项特性的打包器，可以构建出结构比较扁平，性能比较出众的类库，一个纯粹、高效的代码打包工具</p></blockquote> <p>Vite 的打包配置没什么值得说道的地方，所以这里直接上代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配置生产相关</span>
    <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义打包后存放代码的目录名称，默认值为 dist</span>
        <span class="token literal-property property">outDir</span><span class="token operator">:</span> <span class="token string">&quot;MyOutFolder&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 自定义打包后存放静态资源的目录名称，默认值为 assets</span>
        <span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 自定义静态资源中 base64 处理的阈值，默认值为 4kb 以下资源自动转换为 base64 格式</span>
        <span class="token literal-property property">assetsInlineLimit</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token comment">// 配置 rullop 打包策略</span>
        <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 控制输出</span>
            <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// asset 目录的静态资源中文件名称的规则</span>
                <span class="token literal-property property">assetFileNames</span><span class="token operator">:</span> <span class="token string">&quot;[name].[hash].[ext]&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="关于插件-plugin"><a href="#关于插件-plugin" class="header-anchor">#</a> 关于插件 Plugin</h2> <blockquote><p><a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noopener noreferrer">社区插件大全<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>相信有过 Webpack 打包经验的小伙伴们都有使用过插件的经历，因为 Webpack 中可以配置的插件真的太多了。</p> <p>那么在 Vite 中，可以配置的插件在主观上好像并没有几个，这是为啥嘞？</p> <p>究其原因，就是 Vite 自动启用了大量的内置插件。</p> <ul><li>比如 webpack-plugin-html 插件，用于生成项目的 index.html 文件，Vite 项目中会自动调用，无需下载配置。</li> <li>亦或者像 webpack-plugin-clear 插件，用于清空打包后的 dist 目录，Vite 项目也会自动调用，无需下载配置。</li></ul> <p>我们也可以手动启用插件，就用一个简单的插件来演示： <em>vite-aliases</em> 插件（#吐槽# 作者好像并没有按照约定命名 🧐）</p> <p>该插件可以读取 /src 下的目录自动补全路径别名 <code>resolve.alias</code></p> <p>首先下载插件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 切勿下载最新版，最近版有 BUG ~&gt; https://github.com/Subwaytime/vite-aliases/issues/51</span>
<span class="token function">yarn</span> <span class="token function">add</span> vite-aliases@0.9.2
</code></pre></div><p>随后启动在配置项中启用插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ViteAliases <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-aliases&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 关于配置项：https://github.com/subwaytime/vite-aliases#configuration</span>
        <span class="token function">ViteAliases</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">/* optionos */</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>假设你的 Src 目录如下，那么插件会自动生成如下配置：</p> <div class="language- extra-class"><pre class="language-text"><code>src
    assets
    components
    pages
    store
    utils
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@assets&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/assets&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@components&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/components&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@pages&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/pages&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@store&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/store&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@utils&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/utils&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>其实 vite-aliases 的原理是很简单的，只要使用到 Vite 定义好的钩子在配置生命周期的某个阶段修改配置文件即可。我们可以自己定义类似的插件，但在那之前我们需要知道插件的约定。</p> <h3 id="约定"><a href="#约定" class="header-anchor">#</a> 约定</h3> <blockquote><h5 id="致插件创作者"><a href="#致插件创作者" class="header-anchor">#</a> 致插件创作者</h5> <p>Vite 努力秉承<strong>开箱即用</strong>的原则，因此在创作一款新插件前，请确保已经阅读过 <a href="https://vitejs.cn/vite3-cn/guide/features.html" target="_blank" rel="noopener noreferrer">Vite 的功能指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，避免重复劳作。同时还应查看社区是否存在可用插件，包括 <a href="https://github.com/rollup/awesome" target="_blank" rel="noopener noreferrer">兼容 Rollup 的插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 以及 <a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noopener noreferrer">Vite 的专属插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p>如果插件不使用 Vite 特有的钩子，可以作为 <a href="https://vitejs.cn/vite3-cn/guide/api-plugin.html#rollup-plugin-compatibility" target="_blank" rel="noopener noreferrer">兼容 Rollup 的插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来实现，推荐使用 <a href="https://rollupjs.org/guide/en/#conventions" target="_blank" rel="noopener noreferrer">Rollup 插件名称约定<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <blockquote><p>Rollup 是一个纯粹的打包工具，它的插件也应该与打包相关</p></blockquote> <ul><li>Rollup 插件应该有一个带 <code>rollup-plugin-</code> 前缀、语义清晰的名称。</li> <li>在 package.json 中包含 <code>rollup-plugin</code> 和 <code>vite-plugin</code> 关键字。</li></ul> <p>这样，插件也可以用于纯 Rollup 或基于 WMR 的项目。</p> <p>对于 Vite 专属的插件：</p> <ul><li>Vite 插件应该有一个带 <code>vite-plugin-</code> 前缀、语义清晰的名称。</li> <li>在 package.json 中包含 <code>vite-plugin</code> 关键字。</li> <li>在插件文档增加一部分关于为什么本插件是一个 Vite 专属插件的详细说明（如，本插件使用了 Vite 特有的插件钩子）。</li></ul> <p>如果你的插件只适用于特定的框架，它的名字应该遵循以下前缀格式：</p> <ul><li><code>vite-plugin-vue-</code> 前缀作为 Vue 插件</li> <li><code>vite-plugin-react-</code> 前缀作为 React 插件</li> <li><code>vite-plugin-svelte-</code> 前缀作为 Svelte 插件</li></ul> <h3 id="全局钩子"><a href="#全局钩子" class="header-anchor">#</a> 全局钩子</h3> <p>在开发中，Vite 开发服务器会创建一个插件容器来调用 <a href="https://rollupjs.org/guide/en/#build-hooks" target="_blank" rel="noopener noreferrer">Rollup 构建钩子<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，与 Rollup 如出一辙。</p> <p>以下钩子在服务器启动时被调用：</p> <ul><li><a href="https://rollupjs.org/guide/en/#options" target="_blank" rel="noopener noreferrer"><code>options</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#buildstart" target="_blank" rel="noopener noreferrer"><code>buildStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>以下钩子会在每个传入模块请求时被调用：</p> <ul><li><a href="https://rollupjs.org/guide/en/#resolveid" target="_blank" rel="noopener noreferrer"><code>resolveId</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#load" target="_blank" rel="noopener noreferrer"><code>load</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#transform" target="_blank" rel="noopener noreferrer"><code>transform</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>以下钩子在服务器关闭时被调用：</p> <ul><li><a href="https://rollupjs.org/guide/en/#buildend" target="_blank" rel="noopener noreferrer"><code>buildEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#closebundle" target="_blank" rel="noopener noreferrer"><code>closeBundle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>请注意 <a href="https://rollupjs.org/guide/en/#moduleparsed" target="_blank" rel="noopener noreferrer"><code>moduleParsed</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 钩子在开发中是 <strong>不会</strong> 被调用的，因为 Vite 为了性能会避免完整的 AST 解析。</p> <p><a href="https://rollupjs.org/guide/en/#output-generation-hooks" target="_blank" rel="noopener noreferrer">Output Generation Hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（除了 <code>closeBundle</code>) 在开发中是 <strong>不会</strong> 被调用的。你可以认为 Vite 的开发服务器只调用了 <code>rollup.rollup()</code> 而没有调用 <code>bundle.generate()</code>。</p> <h3 id="vite-独有钩子-常用"><a href="#vite-独有钩子-常用" class="header-anchor">#</a> Vite 独有钩子（常用）</h3> <p>Vite 插件也可以提供钩子来服务于特定的 Vite 目标。这些钩子会被 Rollup 忽略。</p> <h4 id="config"><a href="#config" class="header-anchor">#</a> <em>config</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>config<span class="token operator">:</span> UserConfig<span class="token punctuation">,</span> env<span class="token operator">:</span> <span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> command<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> UserConfig <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">void</span>
</code></pre></div><p>用于修改 &amp; 添加原始配置，会在解析 Vite 配置前调用。</p> <p>钩子会接收原始配置（命令行选项指定的会与配置文件合并）和一个描述配置环境的变量，包含正在使用的 <code>mode</code> 和 <code>command</code>。</p> <p>它可以返回一个现有配置中的部分配置对象（将被深度合并到最终配置去），如果默认的合并不能达到预期的结果，你也可以直接修改原始配置。</p> <h5 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 返回部分配置（推荐）</span>
module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;myPlugin-xxx&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">config</span><span class="token operator">:</span> <span class="token parameter">baseConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx/src&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="configresolved"><a href="#configresolved" class="header-anchor">#</a> <em>configResolved</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>config<span class="token operator">:</span> ResolvedConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>在解析 Vite 配置后调用。使用这个钩子读取和存储最终解析的配置。当插件需要根据运行的命令做一些不同的事情时，它也很有用。</p> <h5 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;read-config&quot;</span><span class="token punctuation">,</span>

        <span class="token comment">// 解析 Vite 配置后调用</span>
        <span class="token function">configResolved</span><span class="token punctuation">(</span><span class="token parameter">resolvedConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 存储最终解析的配置</span>
            config <span class="token operator">=</span> resolvedConfig<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">// 在其他钩子中使用存储的配置</span>
        <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>command <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// dev: 由开发服务器调用的插件</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// build: 由 Rollup 调用的插件</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="configureserver"><a href="#configureserver" class="header-anchor">#</a> <em>configureServer</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>server<span class="token operator">:</span> ViteDevServer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><h4 id="transformindexhtml"><a href="#transformindexhtml" class="header-anchor">#</a> <em>transformIndexHtml</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>IndexHtmlTransformHook <span class="token operator">|</span> <span class="token punctuation">{</span> enforce<span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> IndexHtmlTransformHook <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>转换（修改） <code>index.html</code> 的专用钩子。钩子接收当前的 HTML 字符串和转换上下文。上下文在开发期间暴露<a href="https://vitejs.cn/vite3-cn/guide/api-javascript.html#vitedevserver" target="_blank" rel="noopener noreferrer"><code>ViteDevServer</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实例，在构建期间暴露 Rollup 输出的包。</p> <p>这个钩子可以是异步的，并且可以返回以下其中之一:</p> <ul><li>经过转换的 HTML 字符串</li> <li>注入到现有 HTML 中的标签描述符对象数组（<code>{ tag, attrs, children }</code>）。每个标签也可以指定它应该被注入到哪里（默认是在 <code>&lt;head&gt;</code> 之前）</li> <li>一个包含 <code>{ html, tags }</code> 的对象</li></ul> <h5 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> 示例</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;html-transform&quot;</span><span class="token punctuation">,</span>
        <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;title&gt;(.*?)&lt;\/title&gt;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;title&gt;Title replaced!&lt;/title&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件顺序-情景应用"><a href="#插件顺序-情景应用" class="header-anchor">#</a> 插件顺序 &amp; 情景应用</h3> <p>一个 Vite 插件可以额外指定一个 <code>enforce</code> 属性（类似于 webpack 加载器）来调整它的应用顺序。<code>enforce</code> 的值可以是<code>pre</code> 或 <code>post</code>。解析后的插件将按照以下顺序排列：</p> <ul><li>Alias</li> <li>带有 <code>enforce: 'pre'</code> 的用户插件</li> <li>Vite 核心插件</li> <li>没有 enforce 值的用户插件</li> <li>Vite 构建用的插件</li> <li>带有 <code>enforce: 'post'</code> 的用户插件</li> <li>Vite 后置构建插件（最小化，manifest，报告）</li></ul> <hr> <p>默认情况下插件在开发（serve）和构建（build）模式中都会调用。如果插件只需要在预览或构建期间有条件地应用，请使用 <code>apply</code> 属性指明它们仅在 <code>'build'</code> 或 <code>'serve'</code> 模式时调用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;build-only&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 或 'serve'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同时，还可以使用函数来进行更精准的控制：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;build-only&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 或 'serve'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="最佳实践"><a href="#最佳实践" class="header-anchor">#</a> 最佳实践</h3> <p>Vite 插件的定义方式多为一个返回对象的函数，对象中将被注入 Vite 特有钩子或全局（Rollup）的钩子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// myPlugin.js</span>

<span class="token comment">// ? 假设你的插件同时需要 Rollup 钩子与 Vite 钩子类型补全</span>
<span class="token comment">/** @type {(import(&quot;vite&quot;).Plugin | import(&quot;vite&quot;).PluginContainer )}*/</span>
<span class="token comment">// ? 假设你的插件同时只需要 Vite 钩子类型补全</span>
<span class="token comment">/** @type import(&quot;vite&quot;).Plugin*/</span>
<span class="token comment">// ? 假设你的插件同时只需要 Rollup 钩子类型补全</span>
<span class="token comment">/** @type import(&quot;vite&quot;).PluginContainer*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// options 为调用时可以传入的配置对象</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// 插件名称</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;myPlugin-xxx&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 设置插件执行顺序</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 插件执行在哪种环境下 serve 为开发环境 build 为构建环境</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// 修改源配置钩子</span>
        <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">baseConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">baseHtml</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="常用插件-手写插件"><a href="#常用插件-手写插件" class="header-anchor">#</a> 常用插件 &amp; 手写插件</h2> <p>如果你知道 Vite 的独有钩子，那么你就可能已经知道如何手写 vite-aliases 了，就是通过 node 模块读取指定目录，再根据文件属性创建合法的配置对象就好了。</p> <p>我们先在根目录下创建一个 <code>plugins</code> 目录，里面用于存放我们自己写的插件。</p> <div class="language- extra-class"><pre class="language-text"><code>mkdia plugins
</code></pre></div><p>随后创建一个 <code>vite-plugin-my-create-aliases.js</code> 文件，随后输入以下代码，代码很好理解：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite-plugin-my-create-aliases.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> statSync<span class="token punctuation">,</span> readdirSync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认前缀</span>
    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 默认扫描目录</span>
    <span class="token literal-property property">scan</span><span class="token operator">:</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这个文件是在服务器上运行的，所以使用 CommonJS 规范</span>
<span class="token comment">/** @type {(import(&quot;vite&quot;).Plugin | import(&quot;vite&quot;).PluginContainer )}*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> scan<span class="token punctuation">,</span> prefix <span class="token operator">=</span> defaultOptions<span class="token punctuation">.</span>prefix <span class="token punctuation">}</span> <span class="token operator">=</span> defaultOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;vite-plugin-my-createA-liases&quot;</span><span class="token punctuation">,</span>
    <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> scanPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scan <span class="token operator">||</span> <span class="token string">&quot;src&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">createAliasTree</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> scanPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">alias</span><span class="token operator">:</span> result<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @param {string} prefix
 * @param {string} byPath
 * @returns object
 */</span>
<span class="token keyword">function</span> <span class="token function">createAliasTree</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">,</span> byPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> folderTree <span class="token operator">=</span> <span class="token function">readdirSync</span><span class="token punctuation">(</span>byPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> folderName <span class="token keyword">of</span> folderTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span><span class="token punctuation">,</span> folderName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// statSync 返回一个文件的所有信息</span>
        <span class="token keyword">const</span> stat <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outName <span class="token operator">=</span> prefix <span class="token operator">+</span> folderName<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">[</span>outName<span class="token punctuation">]</span> <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>随后使用插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> createAliases <span class="token keyword">from</span> <span class="token string">&quot;./plugins/vite-plugin-my-create-aliases&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">createAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="参考文章-视频"><a href="#参考文章-视频" class="header-anchor">#</a> 参考文章 &amp; 视频</h2> <ul><li><a href="https://www.bilibili.com/video/BV1GN4y1M7P5/?spm_id_from=333.337.search-card.all.click&amp;vd_source=8d08e7af2575a84783be5a41708ac09e" target="_blank" rel="noopener noreferrer">Vite 世界指南（带你从 0 到 1 深入学习 vite）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/bigRiceRice" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>该网站使用 vuepress + @vuepress/theme-blog 搭建 —— by: Big Rice © 2023</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/bigRiceRice.io/dist/assets/js/app.e40e56d4.js" defer></script><script src="/bigRiceRice.io/dist/assets/js/6.4adeed80.js" defer></script><script src="/bigRiceRice.io/dist/assets/js/12.568a4166.js" defer></script><script src="/bigRiceRice.io/dist/assets/js/93.40a27a87.js" defer></script>
  </body>
</html>
