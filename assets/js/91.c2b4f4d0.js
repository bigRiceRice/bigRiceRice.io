(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{396:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("JS 这门语言，在设计之处就没有模块体系，所以他会经历模块化演变，直到 2015 年，TC39（一群浏览器厂商代表组成的委员会）发布了 ES6 规范，ES Modules 才被世人所知，也就是 ESM。而在模块化演变过程中，模块化本身暴露的问题也越来越明显。")]),t._v(" "),s("p",[t._v("项目中的模块越来越多，在管理上造成了混乱，所以迫切需要一些工具解决各种模块类型混乱的问题。Webpack 和 Vite 等工具就是用来解决这些问题的。")]),t._v(" "),s("h2",{attrs:{id:"关于-vite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于-vite"}},[t._v("#")]),t._v(" 关于 Vite")]),t._v(" "),s("blockquote",[s("p",[t._v('Vite（法语意为 "快速的"，发音 '),s("code",[t._v("/vit/")]),t._v('，发音同 "veet"）是一种新型前端构建工具，能够显著提升前端开发体验。')])]),t._v(" "),s("p",[t._v("通俗的来讲，Vite 是与 Webpack 具有同样用途的"),s("strong",[t._v("前端构建工具")]),t._v("（集成了项目模板、热更新、代码打包等多种功能的工具）。")]),t._v(" "),s("h3",{attrs:{id:"什么是构建工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是构建工具"}},[t._v("#")]),t._v(" 什么是构建工具")]),t._v(" "),s("p",[t._v("假设企业需要开发一个成熟的前端项目，那么大概率会运用到以下技术栈：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Vue & React")])]),t._v(" "),s("li",[s("code",[t._v("Typescript")])]),t._v(" "),s("li",[s("code",[t._v("Less & Scss")])]),t._v(" "),s("li",[t._v("各种新技术......")])]),t._v(" "),s("p",[t._v("可惜浏览器并不认识 "),s("code",[t._v("vue & jsx & tsx")]),t._v(" 这些后缀的文件，只能通过解析工具将其转换浏览器能够识别的 "),s("code",[t._v("js")]),t._v(" 文件。")]),t._v(" "),s("p",[t._v("那么我写好一个 "),s("code",[t._v("ts")]),t._v(" 文件，想要在浏览器正常运行，就必须通过 "),s("code",[t._v("tsc")]),t._v(" 命令将其转换为 "),s("code",[t._v("js")]),t._v(" 文件，这很简单 😉，不是吗。")]),t._v(" "),s("p",[t._v("但如果写的是 "),s("code",[t._v("tsx")]),t._v(" 文件呢？我们就得做以下"),s("strong",[t._v("三")]),t._v("步转换：")]),t._v(" "),s("ol",[s("li",[t._v("先转换为 "),s("code",[t._v("jsx")]),t._v(" 文件")]),t._v(" "),s("li",[t._v("再转换为 "),s("code",[t._v("render")]),t._v(" 函数")]),t._v(" "),s("li",[t._v("再封装为 "),s("code",[t._v("js")]),t._v(" 文件")])]),t._v(" "),s("p",[t._v("如果每一次保存都需要执行以上流程来转换，那么你将拥有"),s("strong",[t._v("极其糟糕")]),t._v("的开发体验 🙄。")]),t._v(" "),s("p",[t._v("这个时候我们需要一样东西，它可以"),s("strong",[t._v("自动")]),t._v("的帮我们执行以上流程，这个东西就是"),s("strong",[t._v("构建工具（打包工具）")]),t._v("，构建工具使代码能正常运行到线上。")]),t._v(" "),s("p",[t._v("目前主流的构建工具有：")]),t._v(" "),s("ol",[s("li",[s("p",[s("em",[s("a",{attrs:{href:"https://www.webpackjs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack"),s("OutboundLink")],1)])]),t._v(" "),s("ul",[s("li",[t._v("Webpack 是一个老牌的打包工具，兼容 CommonJS 与 ESM。")]),t._v(" "),s("li",[t._v("社区提供各种各样的插件与 loader，可玩性、扩展性高")])])]),t._v(" "),s("li",[s("p",[s("em",[s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vite"),s("OutboundLink")],1)])]),t._v(" "),s("ul",[s("li",[t._v("Vite 是一个新兴的前端项目构建工具，开箱即用。")]),t._v(" "),s("li",[t._v("社区提供大量的插件，集成了 Rollup 与 esbuild 完成工作流程。")])])]),t._v(" "),s("li",[s("p",[s("em",[s("a",{attrs:{href:"https://esbuild.docschina.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("esbuild"),s("OutboundLink")],1)])]),t._v(" "),s("ul",[s("li",[t._v("一个基于 ESM、使用 Go 语言构建的打包工具，打包速度"),s("strong",[t._v("非常非常非常快")]),t._v("，它被作用在 Vite 的依赖预构建中。")]),t._v(" "),s("li",[t._v("esbuild 在抹平了第三方依赖的语法差异（第三方依赖不一定是 ESM 的语法）的同时，保证了 vite dev 的开发速度")])])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://rollupjs.org/introduction/",target:"_blank",rel:"noopener noreferrer"}},[s("em",[t._v("Rollup")]),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("一个基于 ESM 的高效、纯粹的打包工具，它被作用在 Vite 构建生产代码中，原生 JS 兼容比 esbuild 更佳。")]),t._v(" "),s("li",[t._v("rollup 只会在 vite build 的时候执行构建，主要是构建生产环境可稳定使用的包")])])]),t._v(" "),s("li",[s("p",[t._v("更多 .....")])])]),t._v(" "),s("p",[t._v("如果前端构建工具只有代码转换的话，那就太逊辣，其实构建工具在打包之余还能还能完成以下工作：")]),t._v(" "),s("ul",[s("li",[t._v("模块化兼容：支持"),s("strong",[t._v("各种")]),t._v("规范的模块化开发，导入 & 导出")]),t._v(" "),s("li",[t._v("代码兼容性：使用 "),s("em",[t._v("Babel")]),t._v(" 等工具完成 less & Scss & Vue & Jsx 等文件的"),s("strong",[t._v("语法降级")]),t._v(" & "),s("strong",[t._v("代码兼容")]),t._v(" "),s("ul",[s("li",[t._v("注意：代码兼容性不是构建工具完成的，而是内置的 Babel 等工具完成的")])])]),t._v(" "),s("li",[t._v("提升项目性能：打包文件优化大小（"),s("em",[t._v("Tree Shaking")]),t._v("）、"),s("strong",[t._v("代码分割")]),t._v("等功能")]),t._v(" "),s("li",[t._v("优化开发体验\n"),s("ul",[s("li",[t._v("类如开启一个本地开发服务器，解决"),s("strong",[t._v("跨域问题")])]),t._v(" "),s("li",[t._v("又或者自动监听文件变化，自动调用工具打包，自动热重启服务器，这个过程就是"),s("strong",[t._v("热更新")]),t._v("（"),s("em",[t._v("Hot replacement")]),t._v("）")])])])]),t._v(" "),s("h4",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("构建工具可以"),s("strong",[t._v("减少我们开发时的心智负担，优化开发效率")]),t._v("，它是一个将各种工具，第三包集成到一块最后自动调用的打包工具。")]),t._v(" "),s("p",[t._v("使用构建工具开发项目，使我们不需要考虑使用不同框架不同语法构建的代码如何才能运行到浏览器这种问题，只需要未配置构建工具的配置文件即可让构建工具自动工作（"),s("code",[t._v("webpack.congif.js")]),t._v(" & "),s("code",[t._v("Vite.config.js")]),t._v("）")]),t._v(" "),s("h3",{attrs:{id:"相较于-webpack-的优势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相较于-webpack-的优势"}},[t._v("#")]),t._v(" 相较于 "),s("em",[t._v("Webpack")]),t._v(" 的优势")]),t._v(" "),s("p",[t._v("其实 "),s("em",[t._v("Vite")]),t._v(" 的优势在"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/why.html#why-bundle-for-production",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),s("OutboundLink")],1),t._v("就有过这个议题：")]),t._v(" "),s("blockquote",[s("p",[t._v("然而，当我们开始构建越来越大型的应用时，需要处理的 JavaScript 代码量也呈指数级增长。包含数千个模块的大型项目相当普遍。基于 JavaScript 开发的工具就会开始遇到"),s("strong",[t._v("性能瓶颈")]),t._v("：通常需要很长时间（甚至是几分钟！）才能启动开发服务器，即使使用模块热替换（HMR），文件修改后的效果也需要几秒钟才能在浏览器中反映出来。如此循环往复，迟钝的反馈会极大地影响开发者的开发效率和幸福感。")])]),t._v(" "),s("p",[t._v("上面提到的"),s("strong",[t._v("性能瓶颈")]),t._v("指的就是 "),s("em",[t._v("Webpack")]),t._v(" 在构建大型项目时启动慢，那么 "),s("em",[t._v("Webpack")]),t._v(" 为啥会有性能瓶颈呢？这不得不从 "),s("em",[t._v("Webpack")]),t._v(" 的打包过程说起：")]),t._v(" "),s("blockquote",[s("p",[t._v("Webpack 打包流程图")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301201752735.jpeg",alt:"webpackFlowChart"}})]),t._v(" "),s("p",[t._v("首先我们要知道 Webpack 是"),s("strong",[t._v("支持多种模块化")]),t._v("（"),s("em",[t._v("CommonJS & ESM")]),t._v("），这意味着 Webpack 必须在兼容性上下工具，且早期的 Webpack 起家的时候 ESM 规范并没有落地，导致了存在性能瓶颈问题（底层原理能说改就改吗）。")]),t._v(" "),s("p",[t._v("Webpack 的打包流程大致如下：")]),t._v(" "),s("ol",[s("li",[t._v("通过 "),s("code",[t._v("AST")]),t._v(" 抽象语法递归分析入口文件引用了哪些那些文件，随后将不同的规范转换为 Webpack 规范，并创建好文件依赖")]),t._v(" "),s("li",[t._v("根据文件依赖将所有文件"),s("strong",[t._v("打包")])]),t._v(" "),s("li",[t._v("完成服务器启动")])]),t._v(" "),s("p",[t._v("热更新问题：")]),t._v(" "),s("ul",[s("li",[t._v("以当前修改的文件为入口重新打包，所有涉及到的依赖也都会被重新加载一次（可通过各种各样的 Loader 解决） 😱")])]),t._v(" "),s("p",[t._v("假设是小项目还好，等待时间不需要太久，但如果是非常大的项目的话，打包需要等待的时间将随着项目大小"),s("strong",[t._v("呈指数级上升")]),t._v("，所以体验非常糟糕。")]),t._v(" "),s("blockquote",[s("p",[t._v("可以想象一下，假设一个超级大的项目出现了 bug，你开启了 Webpack 的热更新尝试修改 bug ，但你每次一保存触发热更新都要等上几分钟或者十几分钟，体验将是多么糟糕 😫。")])]),t._v(" "),s("p",[t._v("那么 Vite 会有这种情况吗 😟？")]),t._v(" "),s("p",[t._v("答案是"),s("strong",[t._v("不 会！👌")])]),t._v(" "),s("p",[t._v("vite 法语意为“ "),s("em",[t._v("快速")]),t._v(" ”，如果它存在这种性能问题岂不是自砸招牌？它的解决方式非常巧妙，甚至可以称得上是~~"),s("strong",[t._v("狡猾")]),t._v("~~🤙。")]),t._v(" "),s("blockquote",[s("p",[t._v("Vite 打包流程图")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301201809764.png",alt:"ViteFlowChart"}})]),t._v(" "),s("p",[t._v("首先我们要知道，Vite 使用 "),s("code",[t._v("esbuild")]),t._v(" （背靠 "),s("em",[t._v("ESM")]),t._v(" 规范）为基础来完成依赖预构建，它的打包流程大致如下：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("直接启动")]),t._v("一台静态页面的服务器。")]),t._v(" "),s("li",[t._v("服务器会根据客户端的请求加载不同的模块处理，实现真正的"),s("strong",[t._v("按需加载")])])]),t._v(" "),s("p",[t._v("热更新问题：")]),t._v(" "),s("ul",[s("li",[t._v("采用立即编译当前修改文件的办法，同时使用缓存机制（依赖预构建）\n"),s("ul",[s("li",[t._v("Vite 会将所有依赖文件使用 esbuild 打包一份放到 "),s("code",[t._v("node_moduels/.Vite/deps/")]),t._v(" 下")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("跟 Webpack 反着来")])]),t._v(" "),s("p",[t._v("所以，Vite 具有了"),s("strong",[t._v("快速冷启动、按需编译、模块热更新")]),t._v("等优良特质")]),t._v(" "),s("h4",{attrs:{id:"总结-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结-2"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("Webpack 与 Vite 本质上的区别就在于「 "),s("strong",[t._v("按需加载")]),t._v(" 」。")]),t._v(" "),s("p",[t._v("Webpack 无论怎么提倡按需加载，哪怕底层完成了 "),s("em",[t._v("Webpack_Require")]),t._v(" ，在 ESM 面前都是"),s("strong",[t._v("假的按需加载")]),t._v("。")]),t._v(" "),s("p",[t._v("因为在 ESM 之前浏览器并不支持模块化，而 ESM 的诞生，"),s("strong",[t._v("标志着 Js 有了自己的模块体系")]),t._v("。")]),t._v(" "),s("p",[t._v("所以 Vite 的"),s("strong",[t._v("快")]),t._v("一大步部分是基于 ESM 规范落地产生的红利。")]),t._v(" "),s("blockquote",[s("p",[t._v("上面的都是我个人的理解，如果有错误，那么你可以去看官网对于这个问题的"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/why.html#why-bundle-for-production",target:"_blank",rel:"noopener noreferrer"}},[t._v("回答"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"你必须了解的-vite-与-create-vite-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#你必须了解的-vite-与-create-vite-的区别"}},[t._v("#")]),t._v(" 你必须了解的 "),s("em",[t._v("Vite")]),t._v(" 与 "),s("em",[t._v("create-vite")]),t._v(" 的区别")]),t._v(" "),s("p",[t._v("如果你有过 Vite 项目的开发经验，那么你一定敲过这串命令：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" create vite\n")])])]),s("p",[t._v("你可能会以为是 Vite 构建工具帮我们创建了一个 Vite 项目，但其实不然，Vite 它只是一个打包工具，它不应该把类似 "),s("em",[t._v("vue-cli & create-react-app")]),t._v(" 这类创建项目工程文件、由框架脚手架应该做的事自己做到，那就本末倒置了。")]),t._v(" "),s("p",[t._v("其实这串指令会帮我们安装一个东西，叫做 "),s("em",[t._v("create-vite")]),t._v(" （用于创建 Vite 模板项目的脚手架工具），并运行 "),s("code",[t._v("bin")]),t._v(" 目录下的某个执行配置。")]),t._v(" "),s("p",[t._v("那么 create-vite 与 Vite 的关系是什么？")]),t._v(" "),s("ul",[s("li",[t._v("create-vite 创建的项目中内置了 Vite，就像 vue-cli & create-react-app 中内置了 Webpack 一样。")])]),t._v(" "),s("h2",{attrs:{id:"初体验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初体验"}},[t._v("#")]),t._v(" 初体验")]),t._v(" "),s("p",[t._v("Vite 是"),s("strong",[t._v("开箱即用")]),t._v("（"),s("em",[t._v("out of box")]),t._v("）的，我们不需要做任何额外的配置即可使用 Vite 帮我们处理一些工作：")]),t._v(" "),s("ul",[s("li",[t._v("比如"),s("strong",[t._v("NPM 依赖解析和预构建")]),t._v("。")]),t._v(" "),s("li",[t._v("静态资源处理，即导入一个 .jpg & .json & .mp4 & .svg 文件都会自动处理好，直接导入就可使用。")])]),t._v(" "),s("p",[t._v("何为"),s("strong",[t._v("NPM 依赖解析")]),t._v("？一个最简单的效果就是 Vite 会自动补全我们在 "),s("code",[t._v("html")]),t._v(" 中引入的模块路径，让我们来看下面的例子：")]),t._v(" "),s("p",[t._v("首先我们创建一个 "),s("em",[t._v("Demo")]),t._v(" 目录，并初始化项目，随后添加一个 "),s("em",[t._v("lodash")]),t._v(" 包：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" Demo\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Demo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" init "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" lodash\n")])])]),s("p",[t._v("这是目录最后的结构：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Demo\n├─ index.html\n├─ node_modules\n├─ package.json\n├─ src\n│    └─ main.js\n└─ yarn.lock\n")])])]),s("p",[t._v("这是 html 结构：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("IE=edge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 使用 ESM 模块化语法导入一个 js 文件 --\x3e")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./src/main.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("这是 main.js 代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("如果我们在 index.html 中通过 "),s("em",[t._v("Live Server")]),t._v(" 打开服务器，控制台将会抛出一个错误信息：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('Uncaught TypeError: Failed to resolve module specifier "lodash". Relative references must start with either "/", "./", or "../".\n')])])]),s("p",[t._v("这是因为在 "),s("em",[t._v("ESM")]),t._v(" 规范中导入包只能通过 "),s("code",[t._v("/")]),t._v("、"),s("code",[t._v("./")]),t._v("、"),s("code",[t._v("../")]),t._v(" 等方式来导入，不支持这样的裸模块导入，所以就找不到文件，从而引发报错。")]),t._v(" "),s("blockquote",[s("p",[t._v("ESM 设计成这样是有原因的，假设支持了路径自动补全，将会引发一个问题，即"),s("strong",[t._v("网络多包性能问题")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("假设引入指定的包中又依赖了更多的包，那么将会发起非常多的 HTTP 请求，这可能会将造成 JS 线程堵塞，进而影响性能。")])])]),t._v(" "),s("p",[t._v("那么我们自己将路径补全，还会不会报错呢？")]),t._v(" "),s("p",[t._v("让我们将 main.js 改造成这样如下代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./node_modules/lodash/index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("打开浏览器查看，很不幸，还是会报错 😣，且报错内容如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Uncaught SyntaxError: The requested module './node_modules/lodash/index.js' does not provide an export named 'default'\n")])])]),s("p",[t._v("解释一下就是 lodash/index.js 文件的导出格式不是 ESM 规范，但浏览器只支持 ESM 规范导入，所以是不支持导入该文件的。")]),t._v(" "),s("p",[t._v("那么这个时候，该 Vite 上场表演了！😎")]),t._v(" "),s("p",[t._v("首先安装 Vite：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" vite\n")])])]),s("p",[t._v("并将 main.js 恢复原样：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("随后使用 "),s("code",[t._v("npx vite")]),t._v(" 开启服务器（vite 会自动读取根目录的 index.html 作为 entry 入口文件）")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202107469.png",alt:"image-20230120210733411"}})]),t._v(" "),s("p",[t._v("打开浏览器查看控制台，可以看到 main.js 正常导入了 lodash 工具包，大功告成了！")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202108902.png",alt:"image-20230120210843859"}})]),t._v(" "),s("p",[t._v("这是因为 Vite 的 "),s("strong",[t._v("NPM 依赖解析和预构建")]),t._v("帮我们处理了两件事：")]),t._v(" "),s("ol",[s("li",[t._v("查看依赖文件，并使用 esbuild 进行预构建将 CommonJS / UMD 转换为 ESM 格式")]),t._v(" "),s("li",[t._v("将原本的导入地址重写为合法的 URL，比如 "),s("code",[t._v("/node_modules/.vite/deps/lodash.js?v=ee7e25ee")]),t._v(" 以便浏览器能够正确导入它们。")])]),t._v(" "),s("p",[t._v("如果你足够细心，查看了一下网络请求，那么细心的你会看到上面两件事完成的证据。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202142849.png",alt:"image-20230120214208785"}})]),t._v(" "),s("blockquote",[s("p",[t._v("关于这个例子，官网的"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/features.html#npm-dependency-resolving-and-pre-bundling",target:"_blank",rel:"noopener noreferrer"}},[t._v("描述"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"关于依赖预构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于依赖预构建"}},[t._v("#")]),t._v(" 关于依赖预构建")]),t._v(" "),s("h3",{attrs:{id:"前言-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言-2"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("开始了解依赖预构建之前，我们首先需要明白依赖预构建的"),s("strong",[t._v("动机")]),t._v("，或者说它的存在是为了解决哪些问题。")]),t._v(" "),s("p",[t._v("我们回到 Vite 初体验中的例子，查看一下 lodash/index.js 文件中的模块化导出规范是那种：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202144812.png",alt:"image-20230120214438770"}})]),t._v(" "),s("p",[t._v("当我们看到 "),s("code",[t._v("module.exports")]),t._v(" 的时候不难猜出 "),s("code",[t._v("lodash")]),t._v(" 的模块化导出规范使用的是 "),s("em",[t._v("CommonJS")])]),t._v(" "),s("p",[t._v("再查看一下预构建后的请求地址（即 "),s("em",[t._v("/node_modules/.vite/deps/")]),t._v("）中的 lodash 文件内容")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202207498.png",alt:"image-20230120220708441"}})]),t._v(" "),s("p",[t._v("可以看到，Vite 将其他规范中的导出文件夹经过封装后导出了一个 ESM 规范的文件。")]),t._v(" "),s("p",[t._v("这就是依赖预构建解决的问题之一：")]),t._v(" "),s("ul",[s("li",[t._v("不同模块化规范之间的处理 ——> 统一为 ESM 规范")])]),t._v(" "),s("h3",{attrs:{id:"什么是依赖预构建呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是依赖预构建呢"}},[t._v("#")]),t._v(" 什么是依赖预构建呢？")]),t._v(" "),s("p",[t._v("依赖预构建就是 Vite 会在打包的时候，找到所有依赖文件，对其做一定的封装后"),s("strong",[t._v("调用 esbuild")]),t._v(" 完成一次依赖打包（构建生产代码使用的是 Rollup），然后写入到当前根目录下的 "),s("em",[t._v("/node_modules/.vite/deps/")]),t._v(" 中，这一个过程就被称作“"),s("strong",[t._v("依赖预构建")]),t._v("”。")]),t._v(" "),s("blockquote",[s("p",[t._v("esbuild 在开发阶段（vite dev）使用，主要用来预编译第三方依赖和编译业务代码里的 typescript 代码。")]),t._v(" "),s("p",[t._v("esbuild 在抹平了第三方依赖的语法差异（第三方依赖不一定是 ESM 的语法）的同时，保证了 vite dev 的启动速度。")])]),t._v(" "),s("p",[t._v("所以其实项目中导入的文件在运行后真实地址都在 "),s("code",[t._v(".vite/deps/")]),t._v(" 中存放。")]),t._v(" "),s("p",[s("strong",[t._v("依赖预构建主要解决了以下 3 个问题：")])]),t._v(" "),s("ol",[s("li",[t._v("不同模块化规范之间的兼容问题\n"),s("ul",[s("li",[t._v("调用 esbuild 打包解决")])])]),t._v(" "),s("li",[t._v("路径处理问题\n"),s("ul",[s("li",[t._v("将所有依赖文件全部封装进 "),s("em",[t._v(".vite/deps/")]),t._v(" 下，方便热更新读取")])])]),t._v(" "),s("li",[t._v("多包性能问题\n"),s("ul",[s("li",[t._v("对依赖文件的封装简化了 HTTP 请求的次数，因为"),s("strong",[t._v("多包")]),t._v("已经被集成变为了"),s("strong",[t._v("单包")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("以上为个人的理解，如有错误，你可以查看官方对依赖预构建的"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/dep-pre-bundling.html#dependency-pre-bundling",target:"_blank",rel:"noopener noreferrer"}},[t._v("说明"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("p",[s("strong",[t._v("简单看下多包性能问题")])]),t._v(" "),s("p",[t._v("我们可以配置手动复现多包性能问题，从而进一步了解依赖预构建的强大 👊。")]),t._v(" "),s("p",[t._v("首先添加 "),s("em",[t._v("lodash-es")]),t._v(" 包：")]),t._v(" "),s("blockquote",[s("p",[t._v("该包为 lodash 的 ESM 规范版，假如直接引入，会将所有工具函数作为 ESM 规范引入")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" loadsh-es\n")])])]),s("p",[t._v("在 Vite 项目中引入 "),s("em",[t._v("lodash-es")]),t._v(" ：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash-es"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("注意：添加如下 Vite 配置，忽略依赖预构建")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vite.config.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 依赖yz'h")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("optimizeDeps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 排除数组中的包")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash-es"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("打开服务器，测试一下你的网速有多快 : )")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202314927.gif",alt:"demo"}}),t._v(" "),s("p",[t._v("可以看到，直接请求了 600+ 的包")]),t._v(" "),s("p",[t._v("开启依赖预构建的效果如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301202316283.png",alt:"image-20230120231659227"}})]),t._v(" "),s("h2",{attrs:{id:"关于语法补全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于语法补全"}},[t._v("#")]),t._v(" 关于语法补全")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("如果使用的是 WebStorm，那么你将得到很好的语法补全")])]),t._v(" "),s("li",[s("p",[t._v("如果使用的是 VS Code，那么需要如下配置才能获得语法补全：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vite.config.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("optimizeDeps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash-es"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ——————————————————————————————————")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JsDoc 语法 - vscode 内置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/** @type import("vite").UserConfig */')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("optimizeDeps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lodash-es"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"关于环境处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于环境处理"}},[t._v("#")]),t._v(" 关于环境处理")]),t._v(" "),s("p",[t._v("在 Webpack 中，根据不同环境的不同处理需要定义多个配置文件，所以一个 Webpack 项目根目录下大概率会出现多个配置文件：")]),t._v(" "),s("ol",[s("li",[s("em",[t._v("webpack.config.js")]),t._v("："),s("strong",[t._v("默认")]),t._v("配置文件，只有该文件被"),s("strong",[t._v("默认调用")]),t._v("的。")]),t._v(" "),s("li",[s("em",[t._v("webpack."),s("strong",[t._v("dev")]),t._v(".config.js")]),t._v("：开发环境下配置文件，语义化的自定义配置文件。")]),t._v(" "),s("li",[s("em",[t._v("webpack."),s("strong",[t._v("prod")]),t._v(".config.js")]),t._v("：生产环境下配置文件，语义化的自定义配置文件。")]),t._v(" "),s("li",[s("em",[t._v("webpack."),s("strong",[t._v("base")]),t._v(".config.js")]),t._v("：任何环境下的基础配置文件，语义化的自定义配置文件。")]),t._v(" "),s("li",[s("em",[t._v("webpack.xxx.config.js")]),t._v(" ......")])]),t._v(" "),s("p",[t._v("这些奇奇怪怪的配置文件都是为了将环境区分开来从而在不同环境下执行不同的配置，所以 "),s("em",[t._v("package.json")]),t._v(" 中也需要配置多条命令，或使用不同的处理来完成。")]),t._v(" "),s("p",[t._v("而在 Vite 中，我们可以避免定义多个配置文件与定义不同环境下的调用命令，因为 "),s("code",[t._v("defindeConfig")]),t._v(" 会默认暴露环境模式参数（"),s("code",[t._v("mode")]),t._v("），我们可以通过判断 "),s("code",[t._v("mode")]),t._v(" 的取值来自动执行相应环境下的配置文件，来看下面的例子：")]),t._v(" "),s("p",[t._v("定义一个 "),s("em",[t._v("vite-configs")]),t._v(" 目录，并创建多个配置文件，目录结构如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vite-configs\n▕── base.js # 全局的配置文件\n▕── prod.js # 生产环境下的配置文件\n▕── dev.js  # 开发环境下的配置文件\n")])])]),s("p",[t._v("vite.config.js 代码如下")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  vite.config.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" base "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./vite-configs/base.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" prod "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./vite-configs/prod.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" dev "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./vite-configs/dev.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" environments "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("production")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("调用生产环境下的配置文件")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("prod "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("development")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("调用开发环境下的配置文件")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("dev "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" command "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mode    为开发环境，取值有: `production` & `development`")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// command 为命令环境，取值有: `serve`      & `build`")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" environments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这样我们就完成了根据环境自动调用不同的配置文件，让我们调用看看效果吧。")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("npx vite")]),t._v("：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211124239.png",alt:"image-20230121112435168"}})]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("npx vite build")]),t._v(" ：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211125134.png",alt:"image-20230121112519085"}})]),t._v(" "),s("h2",{attrs:{id:"关于环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于环境变量"}},[t._v("#")]),t._v(" 关于环境变量")]),t._v(" "),s("p",[t._v("环境变量即根据当前代码运行环境的不同而变化的某个值，举个最简单的需求吧：")]),t._v(" "),s("ul",[s("li",[t._v("项目在 development 开发环境中的标题为 “ "),s("em",[t._v("项目开发中")]),t._v(" ”，")]),t._v(" "),s("li",[t._v("项目在 production 生产环境中的标题为 “ "),s("em",[t._v("项目已上线")]),t._v(" ”。")])]),t._v(" "),s("p",[t._v("那么就可以将这个值称为"),s("strong",[t._v("环境变量")]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("在我们开始实现需求前，先了解一些东西。")])]),t._v(" "),s("p",[t._v("首先一个成熟的项目或许有以下几种环境：")]),t._v(" "),s("ul",[s("li",[t._v("开发环境")]),t._v(" "),s("li",[t._v("测试环境")]),t._v(" "),s("li",[t._v("预发布环境")]),t._v(" "),s("li",[t._v("灰度测试环境")]),t._v(" "),s("li",[t._v("线上环境")])]),t._v(" "),s("p",[t._v("那么如何管理这么多环境中的环境变量呢？")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Vite 在环境变量上的处理使用的是一个叫做 "),s("em",[t._v("dotenv")]),t._v(" 的第三方库，默认情况下，dotenv 会读取当前工程根目录（调用 "),s("code",[t._v("yarn dev")]),t._v(" 时的根目录）的一个叫做 "),s("code",[t._v(".env")]),t._v(" 的文件（该文件存放的即是全局的环境变量），并"),s("strong",[t._v("在最后")]),t._v("将它挂载到 "),s("code",[t._v("process.env")]),t._v(" 属性中供服务器使用。")]),t._v(" "),s("blockquote",[s("p",[s("em",[t._v("process")]),t._v(" 是 Node 中的一个对象，该对象代表着当前"),s("strong",[t._v("进程")]),t._v("，"),s("em",[t._v("process.env")]),t._v(" 则代表着当前进程的环境变量")])])])]),t._v(" "),s("p",[t._v("接下来让我们来尝试实现之前说的的需求，在根目录下创建一个 "),s("em",[t._v(".env")]),t._v(" 文件并写入一个 "),s("strong",[t._v("VITE_TITLE")]),t._v(" 环境变量：")]),t._v(" "),s("blockquote",[s("p",[t._v("这里顺便说一嘴，VITE 中使用环境变量的定义也是有约定的：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("默认情况下只有以 “"),s("strong",[t._v("VITE_")]),t._v("” 开头的变量才会在客户端被捕获，访问方式为："),s("code",[t._v("import.meta.env.{参数名}")])])]),t._v(" "),s("li",[s("p",[t._v("所有值都是字符串")])]),t._v(" "),s("li",[s("p",[t._v("对于 true / false 的值，拿到的只能是 'true' / 'false '，并不是 boolean 值，不能直接使用，需要判断 xxx === 'true'。")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# .env\nVITE_TITLE = 默认标题\n")])])]),s("p",[t._v("并在配置文件中打印 "),s("code",[t._v("process.env")]),t._v(" 查看是否环境变量是否正常挂载：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"process.env"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("很可惜，"),s("code",[t._v("process.env")]),t._v(" 上是找不到 "),s("code",[t._v("VITE_TITLE")]),t._v(" 这个属性的，并不是 dotenv 没有工作，而是 Vite 出于更多的考虑而有意为之的 。这其中的原因是涉及到了 Vite 两个关于环境变量的配置项：")]),t._v(" "),s("ol",[s("li",[s("em",[t._v("root")]),t._v("：用于配置 Index.html 所在目录。")]),t._v(" "),s("li",[s("em",[t._v("envDir")]),t._v("：用于配置环境变量的地址")])]),t._v(" "),s("blockquote",[s("p",[t._v("因为有了两个配置项的存在，我们一开时读取的 "),s("code",[t._v("process.env")]),t._v(" 并没有被直接修改，因为后续的配置项可能会影响到它（也可以理解为读取"),s("strong",[t._v("早了")]),t._v("）。")]),t._v(" "),s("p",[t._v("“Vite 默认是不加载 "),s("code",[t._v(".env")]),t._v(" 文件的，因为这些文件需要在执行完 Vite 配置后才能确定加载哪一个，举个例子，"),s("code",[t._v("root")]),t._v(" 和 "),s("code",[t._v("envDir")]),t._v(" 选项会影响加载行为。” —— Vite 官网")])]),t._v(" "),s("p",[t._v("其实说回来 "),s("code",[t._v("process.env")]),t._v(" 对我们开发用处不大，因为 Vite 客户端用不到这些参数，且 Vite 向客户端暴露的环境变量是通过 "),s("code",[t._v("import.meta.env")]),t._v(" 来访问的，所以我们不需要管 "),s("code",[t._v("process.env")]),t._v("，只需要了解就好了。")]),t._v(" "),s("h3",{attrs:{id:"import-meta-env"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#import-meta-env"}},[t._v("#")]),t._v(" "),s("em",[t._v("import.meta.env")])]),t._v(" "),s("blockquote",[s("p",[s("em",[t._v("import.meta.env")]),t._v(" 默认只有 5 个属性：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("BASE_URL")]),t._v("：{string} 部署应用时的基本 URL。他由"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/config/shared-options.html#base",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("base")]),t._v(" 配置项"),s("OutboundLink")],1),t._v("决定。")]),t._v(" "),s("li",[s("strong",[t._v("DEV")]),t._v("：{boolean} 应用是否运行在开发环境 (永远与 "),s("code",[t._v("import.meta.env.PROD")]),t._v("相反)。")]),t._v(" "),s("li",[s("strong",[t._v("MODE")]),t._v("： {string} 应用运行的"),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/env-and-mode.html#modes",target:"_blank",rel:"noopener noreferrer"}},[t._v("模式"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("li",[s("strong",[t._v("PROD")]),t._v("：{boolean} 应用是否运行在生产环境。")]),t._v(" "),s("li",[s("strong",[t._v("SSR")]),t._v("：{boolean} 应用是否运行在 "),s("a",{attrs:{href:"https://vitejs.cn/vite3-cn/guide/ssr.html#conditional-logic",target:"_blank",rel:"noopener noreferrer"}},[t._v("server"),s("OutboundLink")],1),t._v(" 上。")]),t._v(" "),s("li",[t._v("以 "),s("strong",[t._v("VITE_")]),t._v(" 开头的环境变量......")])])]),t._v(" "),s("p",[t._v("那么如何将环境变量添加至 "),s("code",[t._v("import.meta.env")]),t._v(" 供客户端访问呢？")]),t._v(" "),s("p",[t._v("Vite 提供了一个方法，就是 "),s("code",[t._v("loadEnv()")]),t._v(" API，我们可以调用它来手动确认环境变量文件的位置，并根据配置单独获取环境变量，随后获取的环境变量将添加至 "),s("code",[t._v("import.meta.env")]),t._v(" 中，最后返回匹配到的环境变量对象。")]),t._v(" "),s("blockquote",[s("p",[s("strong",[s("em",[t._v("loadEnv 的语法")])])]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadEnv")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" envDir"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prefixes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("mode")]),t._v("：必需，当前的环境模式（development & production 或其它）")]),t._v(" "),s("li",[s("code",[t._v("envDir")]),t._v("：必需，当前环境变量文件的根目录")]),t._v(" "),s("li",[s("code",[t._v("prefixes")]),t._v("：可选，接受的环境变量前缀，默认为 "),s("code",[t._v("VITE_")]),t._v(" "),s("ul",[s("li",[t._v('若传入 ""，则表示加载所有环境变量文件中的'),s("strong",[t._v("所有环境变量")])])])])])]),t._v(" "),s("p",[t._v("让我们承接上文，使用 loadEnv 帮我们找到丢失的 "),s("code",[t._v("VITE_TITLE")]),t._v("。")]),t._v(" "),s("p",[t._v("修改 "),s("em",[t._v("vite.config.js")]),t._v(" ：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loadEnv "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadEnv")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"env"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("关于 "),s("code",[t._v("process.cwd()")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("返回的是一个路径字符串，路径的取值是调用 "),s("code",[t._v("yarn dev")]),t._v(" 时处于的"),s("strong",[t._v("工程根目录")]),t._v("。")])])]),t._v(" "),s("p",[t._v("查看打印结果：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211545692.png",alt:"image-20230121154551620"}})]),t._v(" "),s("p",[t._v("可以看到已经成功读取到 "),s("code",[t._v("VITE_TITLE")]),t._v(" 了 😁。")]),t._v(" "),s("p",[t._v("那么我们如何定义不同环境的环境变量文件供 loadEnv 读取呢？Vite 中只有以下环境变量文件名才能根据 "),s("code",[t._v("mode")]),t._v(" 被自动读取 ：")]),t._v(" "),s("ul",[s("li",[s("em",[t._v(".env")]),t._v("："),s("strong",[t._v("全局")]),t._v("的环境变量文件，总是会被读取。")]),t._v(" "),s("li",[t._v("*.env."),s("strong",[t._v("development*")]),t._v("：开发环境下自动读取的环境变量文件，将覆盖 "),s("em",[t._v(".env")]),t._v(" 中重复的变量。\n"),s("ul",[s("li",[s("strong",[t._v("缩写")]),t._v("为 "),s("em",[t._v(".env.dev")]),t._v(" 是"),s("strong",[t._v("不会自动读取")]),t._v("的。")])])]),t._v(" "),s("li",[t._v("*.env."),s("strong",[t._v("production*")]),t._v("：生产环境下自动读取的环境变量文件，将覆盖 "),s("em",[t._v(".env")]),t._v(" 中重复的变量。\n"),s("ul",[s("li",[s("strong",[t._v("缩写")]),t._v("为 "),s("em",[t._v(".env.prod")]),t._v(" 是"),s("strong",[t._v("不会自动读取")]),t._v("的。")])])]),t._v(" "),s("li",[s("em",[t._v(".env.xxx")]),t._v("：自定义的环境变量文件，若需要读取自定义，那么 "),s("em",[t._v("mode")]),t._v(" 模式也要为自定义。\n"),s("ul",[s("li",[t._v("可通过修改 "),s("code",[t._v("yarn dev --mode xxx")]),t._v(" 的方式保持自动读取，因为 loadEnv 是根据 mode 读取文件名的 😉")])])])]),t._v(" "),s("p",[t._v("好的，回到最开始的需求，在根目录下定义 "),s("em",[t._v(".env.development")]),t._v(" 文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# .env.development\nVITE_TITLE = 项目开发中\n")])])]),s("p",[t._v("定义 "),s("em",[t._v(".env.production")]),t._v(" 文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# .env.production\nVITE_TITLE = 项目已上线\n")])])]),s("p",[t._v("先浅浅的跑一下不同的环境查看变量获取的是否正确吧 💅：")]),t._v(" "),s("p",[t._v("开发环境下：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211615548.png",alt:"image-20230121161500483"}}),t._v(" "),s("p",[t._v("生产环境下：")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211615054.png",alt:"image-20230121161549994"}}),t._v(" "),s("p",[t._v("打印输出正确 👌。")]),t._v(" "),s("p",[t._v("最后让我们创建一个 html 与 index.html 文件，实现需求吧！")]),t._v(" "),s("p",[t._v("这是目录结构：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Demo\n├─ index.html\n├─ node_modules\n├─ package.json\n├─ main.js\n├─ vite.config.js\n└─ yarn.lock\n")])])]),s("p",[t._v("html 文件如下：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./main.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("main.js 代码如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VITE_TITLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这是 vite.config.js 配置文件：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" defineConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loadEnv "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" command "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadEnv")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("package.json 代码如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"main"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"license"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MIT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dev"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite --mode development --open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"prod"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite --mode production --open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vite build"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vite"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^4.0.4"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("开启项目查看：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301211653849.gif",alt:"demo"}})]),t._v(" "),s("p",[t._v("可以看到，需求实现了。")]),t._v(" "),s("p",[t._v("那么到这里就可以介绍一个配置项了：")]),t._v(" "),s("ul",[s("li",[s("strong",[s("em",[t._v("envPrefix")])]),t._v("：设置当前环境变量的"),s("strong",[t._v("取值前缀")]),t._v("，同 loadEnv 中的第三个参数。")])]),t._v(" "),s("p",[t._v("假如我们项目有这样的规范，开发环境中的环境变量使用 _DEV__ 前缀开头，生产环境中的环境变量使用 _PROD__ 前缀开头。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("那么我们就可以在 "),s("em",[t._v("vite.dev.config")]),t._v(" 中定义 "),s("code",[t._v("envPrefix")]),t._v(" 为 “"),s("strong",[t._v("DEV_")]),t._v("”。")])]),t._v(" "),s("li",[s("p",[t._v("在 "),s("em",[t._v("vite.prod.config")]),t._v(" 中定义 "),s("code",[t._v("envPrefix")]),t._v(" 为 “"),s("strong",[t._v("PROD_")]),t._v("”。")])])]),t._v(" "),s("h4",{attrs:{id:"关于-loadenv-的细节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于-loadenv-的细节"}},[t._v("#")]),t._v(" 关于 loadEnv 的细节")]),t._v(" "),s("p",[t._v("当我们调用 loadEnv 后，会做以下几件事情：")]),t._v(" "),s("ol",[s("li",[t._v("直接找到 .env 文件，并解析其中的环境变量，存放到一个对象中")]),t._v(" "),s("li",[t._v("将传进来的 "),s("code",[t._v("mode")]),t._v(" 值拼接后作为查询的文件，语法为 "),s("code",[t._v(".env.[mode]")]),t._v("，并根据传入的目录查找这个 "),s("code",[t._v(".env.[mode]")]),t._v(" 文件存入一个对象")]),t._v(" "),s("li",[t._v("最后将两个对象合并")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("也可以这样理解：")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("findAndParse")]),t._v(" 是一个虚构的函数")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第一步")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseEnv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAndParse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('".env"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第二步")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" modeEnv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAndParse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(".env.")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第三步")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("baseEnv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("modeEnv "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("正是因为 "),s("code",[t._v("mode")]),t._v(" 可以影响到获取的文件，这才支持了多种环境变量文件的存在，假如我有一个 "),s("code",[t._v(".env.test")]),t._v(" 环境变量文件，那么我要将它添加到 "),s("code",[t._v("import.meta.env")]),t._v(" 中，我就要这样启动项目：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--mode")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])]),s("h2",{attrs:{id:"参考文章-视频"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文章-视频"}},[t._v("#")]),t._v(" 参考文章 & 视频")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1GN4y1M7P5/?spm_id_from=333.337.search-card.all.click&vd_source=8d08e7af2575a84783be5a41708ac09e",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vite 世界指南（带你从 0 到 1 深入学习 vite）"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.w3cschool.cn/article/b6e4e9c41df734.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器、ESM 规范、模块化、webpack 和 vite 之间联系？"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=e.exports}}]);