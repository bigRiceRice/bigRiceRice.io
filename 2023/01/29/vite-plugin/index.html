<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite æ’ä»¶ã€å¸¸ç”¨æ’ä»¶ &amp; æ’ä»¶åŸç†ã€‘ | Big Rice ğŸš</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="favicon.ico">
    <meta name="description" content="å…³äº Vite ä¸­çš„ä¸€äº›å¸¸ç”¨æ’ä»¶ä»¥åŠå¦‚ä½•æ‰‹å†™ä¸€ä¸ªç®€å•çš„æ’ä»¶">
    
    <link rel="preload" href="/blog/assets/css/0.styles.a696d05d.css" as="style"><link rel="preload" href="/blog/assets/js/app.52271ad8.js" as="script"><link rel="preload" href="/blog/assets/js/6.4adeed80.js" as="script"><link rel="preload" href="/blog/assets/js/3.606773b1.js" as="script"><link rel="preload" href="/blog/assets/js/94.d6f1a328.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5590a827.js"><link rel="prefetch" href="/blog/assets/js/11.168de83c.js"><link rel="prefetch" href="/blog/assets/js/12.568a4166.js"><link rel="prefetch" href="/blog/assets/js/13.e940090d.js"><link rel="prefetch" href="/blog/assets/js/14.f1d5c634.js"><link rel="prefetch" href="/blog/assets/js/15.d8fb3f3a.js"><link rel="prefetch" href="/blog/assets/js/16.8df64f59.js"><link rel="prefetch" href="/blog/assets/js/17.b7987f67.js"><link rel="prefetch" href="/blog/assets/js/18.4032e905.js"><link rel="prefetch" href="/blog/assets/js/19.ca60a6f2.js"><link rel="prefetch" href="/blog/assets/js/20.6ed4eadb.js"><link rel="prefetch" href="/blog/assets/js/21.7f318db6.js"><link rel="prefetch" href="/blog/assets/js/22.cb313a94.js"><link rel="prefetch" href="/blog/assets/js/23.9b02965b.js"><link rel="prefetch" href="/blog/assets/js/24.0dc5ff3e.js"><link rel="prefetch" href="/blog/assets/js/25.43660fac.js"><link rel="prefetch" href="/blog/assets/js/26.4f5b1905.js"><link rel="prefetch" href="/blog/assets/js/27.0853cfce.js"><link rel="prefetch" href="/blog/assets/js/28.582fcf1c.js"><link rel="prefetch" href="/blog/assets/js/29.e8e1123e.js"><link rel="prefetch" href="/blog/assets/js/30.b6d8bbbe.js"><link rel="prefetch" href="/blog/assets/js/31.bbd098e3.js"><link rel="prefetch" href="/blog/assets/js/32.8e24d0c3.js"><link rel="prefetch" href="/blog/assets/js/33.e9c1b639.js"><link rel="prefetch" href="/blog/assets/js/34.7a8c94b5.js"><link rel="prefetch" href="/blog/assets/js/35.e69c119d.js"><link rel="prefetch" href="/blog/assets/js/36.567f1f05.js"><link rel="prefetch" href="/blog/assets/js/37.31e20c86.js"><link rel="prefetch" href="/blog/assets/js/38.de971dc4.js"><link rel="prefetch" href="/blog/assets/js/39.f588d93f.js"><link rel="prefetch" href="/blog/assets/js/4.34a3a307.js"><link rel="prefetch" href="/blog/assets/js/40.8107d5e5.js"><link rel="prefetch" href="/blog/assets/js/41.3f59a68b.js"><link rel="prefetch" href="/blog/assets/js/42.80a7b102.js"><link rel="prefetch" href="/blog/assets/js/43.39f49b21.js"><link rel="prefetch" href="/blog/assets/js/44.b69b697f.js"><link rel="prefetch" href="/blog/assets/js/45.6368e269.js"><link rel="prefetch" href="/blog/assets/js/46.2c134927.js"><link rel="prefetch" href="/blog/assets/js/47.913b0613.js"><link rel="prefetch" href="/blog/assets/js/48.bfdb65c7.js"><link rel="prefetch" href="/blog/assets/js/49.4d7bf943.js"><link rel="prefetch" href="/blog/assets/js/5.44ec780a.js"><link rel="prefetch" href="/blog/assets/js/50.ad5e5ae9.js"><link rel="prefetch" href="/blog/assets/js/51.60f76d0f.js"><link rel="prefetch" href="/blog/assets/js/52.7e85ded7.js"><link rel="prefetch" href="/blog/assets/js/53.6a179539.js"><link rel="prefetch" href="/blog/assets/js/54.adeff585.js"><link rel="prefetch" href="/blog/assets/js/55.495f17ce.js"><link rel="prefetch" href="/blog/assets/js/56.938a3529.js"><link rel="prefetch" href="/blog/assets/js/57.4615ba1a.js"><link rel="prefetch" href="/blog/assets/js/58.1f35c496.js"><link rel="prefetch" href="/blog/assets/js/59.ac0a7da9.js"><link rel="prefetch" href="/blog/assets/js/60.905fe27a.js"><link rel="prefetch" href="/blog/assets/js/61.f63cc4a4.js"><link rel="prefetch" href="/blog/assets/js/62.79bd5628.js"><link rel="prefetch" href="/blog/assets/js/63.c6508c1b.js"><link rel="prefetch" href="/blog/assets/js/64.d845370a.js"><link rel="prefetch" href="/blog/assets/js/65.e5a00f33.js"><link rel="prefetch" href="/blog/assets/js/66.912efc81.js"><link rel="prefetch" href="/blog/assets/js/67.7651882e.js"><link rel="prefetch" href="/blog/assets/js/68.64078e52.js"><link rel="prefetch" href="/blog/assets/js/69.87a1fc99.js"><link rel="prefetch" href="/blog/assets/js/7.a918f9c2.js"><link rel="prefetch" href="/blog/assets/js/70.d6112df9.js"><link rel="prefetch" href="/blog/assets/js/71.6d71cfab.js"><link rel="prefetch" href="/blog/assets/js/72.f98b9f33.js"><link rel="prefetch" href="/blog/assets/js/73.076e80b8.js"><link rel="prefetch" href="/blog/assets/js/74.1eb2ee3c.js"><link rel="prefetch" href="/blog/assets/js/75.26acbc88.js"><link rel="prefetch" href="/blog/assets/js/76.bee96165.js"><link rel="prefetch" href="/blog/assets/js/77.eb73d9b9.js"><link rel="prefetch" href="/blog/assets/js/78.98103b7a.js"><link rel="prefetch" href="/blog/assets/js/79.040ca8a0.js"><link rel="prefetch" href="/blog/assets/js/8.45199285.js"><link rel="prefetch" href="/blog/assets/js/80.ce2ca909.js"><link rel="prefetch" href="/blog/assets/js/81.49095bba.js"><link rel="prefetch" href="/blog/assets/js/82.431beb32.js"><link rel="prefetch" href="/blog/assets/js/83.b28417c6.js"><link rel="prefetch" href="/blog/assets/js/84.26b7d911.js"><link rel="prefetch" href="/blog/assets/js/85.76877657.js"><link rel="prefetch" href="/blog/assets/js/86.970bffa3.js"><link rel="prefetch" href="/blog/assets/js/87.1525542d.js"><link rel="prefetch" href="/blog/assets/js/88.6aa16743.js"><link rel="prefetch" href="/blog/assets/js/89.dcdf9a4f.js"><link rel="prefetch" href="/blog/assets/js/9.2eadd3a5.js"><link rel="prefetch" href="/blog/assets/js/90.f072e392.js"><link rel="prefetch" href="/blog/assets/js/91.61c4f186.js"><link rel="prefetch" href="/blog/assets/js/92.c08a9625.js"><link rel="prefetch" href="/blog/assets/js/93.bfe8d306.js"><link rel="prefetch" href="/blog/assets/js/95.cf07d6c5.js"><link rel="prefetch" href="/blog/assets/js/96.80af01f4.js"><link rel="prefetch" href="/blog/assets/js/97.126c265d.js"><link rel="prefetch" href="/blog/assets/js/vuejs-paginate.bd98283b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.a696d05d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/blog/" class="nav-link home-link">Big Rice ğŸš </a> <button class="back" style="display:;">â†©</button></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/blog/FrameWork/" class="nav-link">æ¡†æ¶</a></li><li class="nav-item"><a href="/blog/Css/" class="nav-link">Css</a></li><li class="nav-item"><a href="/blog/API/" class="nav-link">API</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/blog/" class="nav-link mobile-home-link">Big Rice ğŸš </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/blog/FrameWork/" class="nav-link">æ¡†æ¶</a></li><li class="mobile-nav-item"><a href="/blog/Css/" class="nav-link">Css</a></li><li class="mobile-nav-item"><a href="/blog/API/" class="nav-link">API</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Vite æ’ä»¶ã€å¸¸ç”¨æ’ä»¶ &amp; æ’ä»¶åŸç†ã€‘
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">bigRice</span> <span itemprop="address"> Â  in äº‘æ¢¦æ³½</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2023-01-29T00:00:00.000Z">
      2023-01-29
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/blog/tag/Vite" data-v-42ccfcd5><span data-v-42ccfcd5>Vite</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="å…³äºæ’ä»¶-plugin"><a href="#å…³äºæ’ä»¶-plugin" class="header-anchor">#</a> å…³äºæ’ä»¶ Plugin</h2> <blockquote><p><a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noopener noreferrer">ç¤¾åŒºæ’ä»¶å¤§å…¨<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>ç›¸ä¿¡æœ‰è¿‡ Webpack æ‰“åŒ…ç»éªŒçš„å°ä¼™ä¼´ä»¬éƒ½æœ‰ä½¿ç”¨è¿‡æ’ä»¶çš„ç»å†ï¼Œå› ä¸º Webpack ä¸­å¯ä»¥é…ç½®çš„æ’ä»¶çœŸçš„å¤ªå¤šäº†ã€‚</p> <p>é‚£ä¹ˆåœ¨ Vite ä¸­ï¼Œå¯ä»¥é…ç½®çš„æ’ä»¶åœ¨ä¸»è§‚ä¸Šå¥½åƒå¹¶æ²¡æœ‰å‡ ä¸ªï¼Œè¿™æ˜¯ä¸ºå•¥å˜ï¼Ÿ</p> <p>ç©¶å…¶åŸå› ï¼Œå°±æ˜¯ Vite è‡ªåŠ¨å¯ç”¨äº†å¤§é‡çš„å†…ç½®æ’ä»¶ã€‚</p> <ul><li>æ¯”å¦‚ webpack-plugin-html æ’ä»¶ï¼Œç”¨äºç”Ÿæˆé¡¹ç›®çš„ index.html æ–‡ä»¶ï¼ŒVite é¡¹ç›®ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œæ— éœ€ä¸‹è½½é…ç½®ã€‚</li> <li>äº¦æˆ–è€…åƒ webpack-plugin-clear æ’ä»¶ï¼Œç”¨äºæ¸…ç©ºæ‰“åŒ…åçš„ dist ç›®å½•ï¼ŒVite é¡¹ç›®ä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œæ— éœ€ä¸‹è½½é…ç½®ã€‚</li></ul> <p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¯ç”¨æ’ä»¶ï¼Œå°±ç”¨ä¸€ä¸ªç®€å•çš„æ’ä»¶æ¥æ¼”ç¤ºï¼š <em>vite-aliases</em> æ’ä»¶ï¼ˆ#åæ§½# ä½œè€…å¥½åƒå¹¶æ²¡æœ‰æŒ‰ç…§çº¦å®šå‘½å ğŸ§ï¼‰</p> <p>è¯¥æ’ä»¶å¯ä»¥è¯»å– /src ä¸‹çš„ç›®å½•è‡ªåŠ¨è¡¥å…¨è·¯å¾„åˆ«å <code>resolve.alias</code></p> <p>é¦–å…ˆä¸‹è½½æ’ä»¶ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># åˆ‡å‹¿ä¸‹è½½æœ€æ–°ç‰ˆï¼Œæœ€è¿‘ç‰ˆæœ‰ BUG ~&gt; https://github.com/Subwaytime/vite-aliases/issues/51</span>
<span class="token function">yarn</span> <span class="token function">add</span> vite-aliases@0.9.2
</code></pre></div><p>éšåå¯åŠ¨åœ¨é…ç½®é¡¹ä¸­å¯ç”¨æ’ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ViteAliases <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-aliases&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// å…³äºé…ç½®é¡¹ï¼šhttps://github.com/subwaytime/vite-aliases#configuration</span>
        <span class="token function">ViteAliases</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">/* optionos */</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å‡è®¾ä½ çš„ Src ç›®å½•å¦‚ä¸‹ï¼Œé‚£ä¹ˆæ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆå¦‚ä¸‹é…ç½®ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>src
    assets
    components
    pages
    store
    utils
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@assets&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/assets&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@components&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/components&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@pages&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/pages&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@store&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/store&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@utils&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">&quot;${your_project_path}/src/utils&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>å…¶å® vite-aliases çš„åŸç†æ˜¯å¾ˆç®€å•çš„ï¼Œåªè¦ä½¿ç”¨åˆ° Vite å®šä¹‰å¥½çš„é’©å­åœ¨é…ç½®ç”Ÿå‘½å‘¨æœŸçš„æŸä¸ªé˜¶æ®µä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ç±»ä¼¼çš„æ’ä»¶ï¼Œä½†åœ¨é‚£ä¹‹å‰æˆ‘ä»¬éœ€è¦çŸ¥é“æ’ä»¶çš„çº¦å®šã€‚</p> <h3 id="çº¦å®š"><a href="#çº¦å®š" class="header-anchor">#</a> çº¦å®š</h3> <blockquote><p><strong>è‡´æ’ä»¶åˆ›ä½œè€…</strong></p> <p>Vite åŠªåŠ›ç§‰æ‰¿<strong>å¼€ç®±å³ç”¨</strong>çš„åŸåˆ™ï¼Œå› æ­¤åœ¨åˆ›ä½œä¸€æ¬¾æ–°æ’ä»¶å‰ï¼Œè¯·ç¡®ä¿å·²ç»é˜…è¯»è¿‡ <a href="https://vitejs.cn/vite3-cn/guide/features.html" target="_blank" rel="noopener noreferrer">Vite çš„åŠŸèƒ½æŒ‡å—<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œé¿å…é‡å¤åŠ³ä½œã€‚åŒæ—¶è¿˜åº”æŸ¥çœ‹ç¤¾åŒºæ˜¯å¦å­˜åœ¨å¯ç”¨æ’ä»¶ï¼ŒåŒ…æ‹¬ <a href="https://github.com/rollup/awesome" target="_blank" rel="noopener noreferrer">å…¼å®¹ Rollup çš„æ’ä»¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä»¥åŠ <a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noopener noreferrer">Vite çš„ä¸“å±æ’ä»¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p></blockquote> <p>å¦‚æœæ’ä»¶ä¸ä½¿ç”¨ Vite ç‰¹æœ‰çš„é’©å­ï¼Œå¯ä»¥ä½œä¸º <a href="https://vitejs.cn/vite3-cn/guide/api-plugin.html#rollup-plugin-compatibility" target="_blank" rel="noopener noreferrer">å…¼å®¹ Rollup çš„æ’ä»¶<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ¥å®ç°ï¼Œæ¨èä½¿ç”¨ <a href="https://rollupjs.org/guide/en/#conventions" target="_blank" rel="noopener noreferrer">Rollup æ’ä»¶åç§°çº¦å®š<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <blockquote><p>Rollup æ˜¯ä¸€ä¸ªçº¯ç²¹çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„æ’ä»¶ä¹Ÿåº”è¯¥ä¸æ‰“åŒ…ç›¸å…³</p></blockquote> <ul><li>Rollup æ’ä»¶åº”è¯¥æœ‰ä¸€ä¸ªå¸¦ <code>rollup-plugin-</code> å‰ç¼€ã€è¯­ä¹‰æ¸…æ™°çš„åç§°ã€‚</li> <li>åœ¨ package.json ä¸­åŒ…å« <code>rollup-plugin</code> å’Œ <code>vite-plugin</code> å…³é”®å­—ã€‚</li></ul> <p>è¿™æ ·ï¼Œæ’ä»¶ä¹Ÿå¯ä»¥ç”¨äºçº¯ Rollup æˆ–åŸºäº WMR çš„é¡¹ç›®ã€‚</p> <p>å¯¹äº Vite ä¸“å±çš„æ’ä»¶ï¼š</p> <ul><li>Vite æ’ä»¶åº”è¯¥æœ‰ä¸€ä¸ªå¸¦ <code>vite-plugin-</code> å‰ç¼€ã€è¯­ä¹‰æ¸…æ™°çš„åç§°ã€‚</li> <li>åœ¨ package.json ä¸­åŒ…å« <code>vite-plugin</code> å…³é”®å­—ã€‚</li> <li>åœ¨æ’ä»¶æ–‡æ¡£å¢åŠ ä¸€éƒ¨åˆ†å…³äºä¸ºä»€ä¹ˆæœ¬æ’ä»¶æ˜¯ä¸€ä¸ª Vite ä¸“å±æ’ä»¶çš„è¯¦ç»†è¯´æ˜ï¼ˆå¦‚ï¼Œæœ¬æ’ä»¶ä½¿ç”¨äº† Vite ç‰¹æœ‰çš„æ’ä»¶é’©å­ï¼‰ã€‚</li></ul> <p>å¦‚æœä½ çš„æ’ä»¶åªé€‚ç”¨äºç‰¹å®šçš„æ¡†æ¶ï¼Œå®ƒçš„åå­—åº”è¯¥éµå¾ªä»¥ä¸‹å‰ç¼€æ ¼å¼ï¼š</p> <ul><li><code>vite-plugin-vue-</code> å‰ç¼€ä½œä¸º Vue æ’ä»¶</li> <li><code>vite-plugin-react-</code> å‰ç¼€ä½œä¸º React æ’ä»¶</li> <li><code>vite-plugin-svelte-</code> å‰ç¼€ä½œä¸º Svelte æ’ä»¶</li></ul> <h2 id="æ’ä»¶-api"><a href="#æ’ä»¶-api" class="header-anchor">#</a> æ’ä»¶ API</h2> <h3 id="vite-é’©å­"><a href="#vite-é’©å­" class="header-anchor">#</a> Vite é’©å­</h3> <blockquote><p>Vite é’©å­ç”¨äºé…ç½® &amp; ä¿®æ”¹ Vite åŸæœ‰çš„æŸäº›é…ç½®æˆ–å…¶ä»–åŠŸèƒ½</p></blockquote> <p>Vite æ’ä»¶ä¹Ÿå¯ä»¥æä¾›é’©å­æ¥æœåŠ¡äºç‰¹å®šçš„ Vite ç›®æ ‡ã€‚è¿™äº›é’©å­ä¼šè¢« Rollup å¿½ç•¥ã€‚</p> <h4 id="config"><a href="#config" class="header-anchor">#</a> <em>config</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>config<span class="token operator">:</span> UserConfig<span class="token punctuation">,</span> env<span class="token operator">:</span> <span class="token punctuation">{</span> mode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> command<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> UserConfig <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">void</span>
</code></pre></div><p>ç”¨äºä¿®æ”¹ &amp; æ·»åŠ åŸå§‹é…ç½®ï¼Œä¼šåœ¨è§£æ Vite é…ç½®å‰è°ƒç”¨ã€‚</p> <p>é’©å­ä¼šæ¥æ”¶åŸå§‹é…ç½®ï¼ˆå‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šçš„ä¼šä¸é…ç½®æ–‡ä»¶åˆå¹¶ï¼‰å’Œä¸€ä¸ªæè¿°é…ç½®ç¯å¢ƒçš„å˜é‡ï¼ŒåŒ…å«æ­£åœ¨ä½¿ç”¨çš„ <code>mode</code> å’Œ <code>command</code>ã€‚</p> <p>å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªç°æœ‰é…ç½®ä¸­çš„éƒ¨åˆ†é…ç½®å¯¹è±¡ï¼ˆå°†è¢«æ·±åº¦åˆå¹¶åˆ°æœ€ç»ˆé…ç½®å»ï¼‰ï¼Œå¦‚æœé»˜è®¤çš„åˆå¹¶ä¸èƒ½è¾¾åˆ°é¢„æœŸçš„ç»“æœï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹åŸå§‹é…ç½®ã€‚</p> <h5 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="header-anchor">#</a> ç¤ºä¾‹</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¿”å›éƒ¨åˆ†é…ç½®ï¼ˆæ¨èï¼‰</span>
module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;myPlugin-xxx&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">config</span><span class="token operator">:</span> <span class="token parameter">baseConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx/src&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="configresolved"><a href="#configresolved" class="header-anchor">#</a> <em>configResolved</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>config<span class="token operator">:</span> ResolvedConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>è¯¥é’©å­åœ¨è§£æ Vite é…ç½®å<strong>æœ€å</strong>æ‰è°ƒç”¨ï¼Œå®ƒçš„å¤§è‡´ä½¿ç”¨æ–¹å¼ä¸ <code>config</code> é’©å­ä¸€è‡´ã€‚</p> <p>ä½¿ç”¨è¿™ä¸ªé’©å­è¯»å–å’Œå­˜å‚¨æœ€ç»ˆè§£æçš„é…ç½®ã€‚å½“æ’ä»¶éœ€è¦æ ¹æ®è¿è¡Œçš„å‘½ä»¤åšä¸€äº›ä¸åŒçš„äº‹æƒ…æ—¶ï¼Œå®ƒä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p> <h5 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="header-anchor">#</a> ç¤ºä¾‹</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;read-config&quot;</span><span class="token punctuation">,</span>

        <span class="token comment">// è§£æ Vite é…ç½®åè°ƒç”¨</span>
        <span class="token function">configResolved</span><span class="token punctuation">(</span><span class="token parameter">resolvedConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å­˜å‚¨æœ€ç»ˆè§£æçš„é…ç½®</span>
            config <span class="token operator">=</span> resolvedConfig<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        <span class="token comment">// åœ¨å…¶ä»–é’©å­ä¸­ä½¿ç”¨å­˜å‚¨çš„é…ç½®</span>
        <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>command <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// dev: ç”±å¼€å‘æœåŠ¡å™¨è°ƒç”¨çš„æ’ä»¶</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// build: ç”± Rollup è°ƒç”¨çš„æ’ä»¶</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="configureserver"><a href="#configureserver" class="header-anchor">#</a> <em>configureServer</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>server<span class="token operator">:</span> ViteDevServer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>æ˜¯ä¸€ä¸ªä¸æœåŠ¡å™¨ç›¸å…³çš„é’©å­ï¼Œç”¨äºé…ç½® &amp; è®¾ç½®å¼€å‘æœåŠ¡å™¨ã€‚æœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯åœ¨å†…éƒ¨ <a href="https://github.com/senchalabs/connect" target="_blank" rel="noopener noreferrer">connect<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åº”ç”¨ç¨‹åºä¸­<strong>æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶</strong>ï¼š</p> <h5 id="æ³¨å…¥å‰ç½®ä¸­é—´ä»¶"><a href="#æ³¨å…¥å‰ç½®ä¸­é—´ä»¶" class="header-anchor">#</a> æ³¨å…¥å‰ç½®ä¸­é—´ä»¶</h5> <p><code>configureServer</code> é’©å­å°†åœ¨å†…éƒ¨ä¸­é—´ä»¶è¢«å®‰è£…<strong>å‰</strong>è°ƒç”¨ï¼Œæ‰€ä»¥è‡ªå®šä¹‰çš„ä¸­é—´ä»¶å°†ä¼šé»˜è®¤ä¼šæ¯”å†…éƒ¨ä¸­é—´ä»¶æ—©è¿è¡Œã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;configure-server&quot;</span><span class="token punctuation">,</span>
    <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// middlewares æ„ä¸ºä¸­é—´ä»¶</span>
        server<span class="token punctuation">.</span>middlewares<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="æ³¨å…¥åç½®ä¸­é—´ä»¶"><a href="#æ³¨å…¥åç½®ä¸­é—´ä»¶" class="header-anchor">#</a> æ³¨å…¥åç½®ä¸­é—´ä»¶</h5> <p>å¦‚æœä½ æƒ³æ³¨å…¥ä¸€ä¸ªåœ¨å†…éƒ¨ä¸­é—´ä»¶ <strong>ä¹‹å</strong> è¿è¡Œçš„ä¸­é—´ä»¶ï¼Œä½ å¯ä»¥åœ¨ <code>configureServer</code> è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†ä¼šåœ¨å†…éƒ¨ä¸­é—´ä»¶å®‰è£…åæ‰è¢«è°ƒç”¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;configure-server&quot;</span><span class="token punctuation">,</span>
    <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿”å›ä¸€ä¸ªåœ¨å†…éƒ¨ä¸­é—´ä»¶å®‰è£…å</span>
        <span class="token comment">// è¢«è°ƒç”¨çš„åç½®é’©å­</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            server<span class="token punctuation">.</span>middlewares<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†...</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="æ³¨æ„"><a href="#æ³¨æ„" class="header-anchor">#</a> æ³¨æ„</h5> <p><code>configureServer</code> åœ¨æ‰“åŒ…åå°†ä¸ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥å…¶ä»–é’©å­éœ€è¦é˜²èŒƒå®ƒç¼ºå¤±ã€‚</p> <h4 id="configurepreviewserver"><a href="#configurepreviewserver" class="header-anchor">#</a> <em>configurePreviewServer</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>server<span class="token operator">:</span> <span class="token punctuation">{</span> middlewares<span class="token operator">:</span> Connect<span class="token punctuation">.</span>Server<span class="token punctuation">,</span> httpServer<span class="token operator">:</span> http<span class="token punctuation">.</span>Server <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>ä¸ <code>configureServer</code> é’©å­ä½œç”¨ç›¸åŒä½†æ˜¯ä½œç”¨åœ¨<strong>é¢„è§ˆæœåŠ¡å™¨</strong>ï¼Œå®ƒçš„ä½¿ç”¨è¯­æ³•ä¸ <code>configureServer</code> ä¿æŒä¸€è‡´ã€‚</p> <blockquote><p>é¢„è§ˆæœåŠ¡å™¨å¹¿ä¹‰æ¥è®²æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå¯ä»¥ç›´æ¥<strong>é¢„è§ˆæ‰“åŒ…è¿‡åçš„ index.html æ–‡ä»¶</strong>ï¼Œå°±åƒ VS Code ä¸­çš„ Live Serve æ’ä»¶ä¸€æ ·ã€‚</p> <p>å¯ä»¥é€šè¿‡ <code>npx vite preview</code> å¼€å¯ä¸€ä¸ªé¢„è§ˆæœåŠ¡å™¨ã€‚</p></blockquote> <h4 id="transformindexhtml"><a href="#transformindexhtml" class="header-anchor">#</a> <em>transformIndexHtml</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code>IndexHtmlTransformHook <span class="token operator">|</span> <span class="token punctuation">{</span> enforce<span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> IndexHtmlTransformHook <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>è½¬æ¢ï¼ˆä¿®æ”¹ï¼‰ <code>index.html</code> çš„ä¸“ç”¨é’©å­ã€‚é’©å­æ¥æ”¶å½“å‰çš„ HTML å­—ç¬¦ä¸²å’Œè½¬æ¢ä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡åœ¨å¼€å‘æœŸé—´æš´éœ² <a href="https://vitejs.cn/vite3-cn/guide/api-javascript.html#vitedevserver" target="_blank" rel="noopener noreferrer"><code>ViteDevServer</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å®ä¾‹ï¼Œåœ¨æ„å»ºæœŸé—´æš´éœ² Rollup è¾“å‡ºçš„åŒ…ã€‚</p> <p>è¿™ä¸ªé’©å­å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€:</p> <ul><li>ç»è¿‡è½¬æ¢çš„ HTML å­—ç¬¦ä¸²</li> <li>æ³¨å…¥åˆ°ç°æœ‰ HTML ä¸­çš„æ ‡ç­¾æè¿°ç¬¦å¯¹è±¡æ•°ç»„ï¼ˆ<code>{ tag, attrs, children }</code>ï¼‰ã€‚æ¯ä¸ªæ ‡ç­¾ä¹Ÿå¯ä»¥æŒ‡å®šå®ƒåº”è¯¥è¢«æ³¨å…¥åˆ°å“ªé‡Œï¼ˆé»˜è®¤æ˜¯åœ¨ <code>&lt;head&gt;</code> ä¹‹å‰ï¼‰</li> <li>ä¸€ä¸ªåŒ…å« <code>{ html, tags }</code> çš„å¯¹è±¡</li></ul> <h5 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="header-anchor">#</a> ç¤ºä¾‹</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;html-transform&quot;</span><span class="token punctuation">,</span>
        <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;title&gt;(.*?)&lt;\/title&gt;</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;title&gt;Title replaced!&lt;/title&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="handlehotupdate"><a href="#handlehotupdate" class="header-anchor">#</a> <em>handleHotUpdate</em></h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span>ctx<span class="token operator">:</span> HmrContext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ModuleNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Array</span><span class="token operator">&lt;</span>ModuleNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token operator">&gt;</span>
</code></pre></div><p>è¯¥é’©å­ç”¨äºæ‰§è¡Œè‡ªå®šä¹‰ HMR çƒ­æ›´æ–°è¡Œä¸ºã€‚é’©å­æ¥æ”¶ä¸€ä¸ªå¸¦æœ‰ä»¥ä¸‹ç­¾åçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">HmrContext</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    timestamp<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    modules<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ModuleNode<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token function-variable function">read</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    server<span class="token operator">:</span> ViteDevServer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>modules</code> æ˜¯å—æ›´æ”¹æ–‡ä»¶å½±å“çš„æ¨¡å—æ•°ç»„ã€‚å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå› ä¸ºå•ä¸ªæ–‡ä»¶å¯èƒ½æ˜ å°„åˆ°å¤šä¸ªæœåŠ¡æ¨¡å—ï¼ˆä¾‹å¦‚ Vue å•æ–‡ä»¶ç»„ä»¶ï¼‰ã€‚</li> <li><code>read</code> è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥è¯»å‡½æ•°ï¼Œå®ƒè¿”å›æ–‡ä»¶çš„å†…å®¹ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºåœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œæ–‡ä»¶æ›´æ”¹çš„å›è°ƒå‡½æ•°å¯èƒ½ä¼šåœ¨ç¼–è¾‘å™¨å®Œæˆæ–‡ä»¶æ›´æ–°ä¹‹å‰è¿‡å¿«åœ°è§¦å‘ï¼Œå¹¶ <code>fs.readFile</code> ç›´æ¥ä¼šè¿”å›ç©ºå†…å®¹ã€‚ä¼ å…¥çš„ <code>read</code> å‡½æ•°è§„èŒƒäº†è¿™ç§è¡Œä¸ºã€‚</li></ul> <p>é’©å­å¯ä»¥é€‰æ‹©:</p> <ul><li><p>è¿‡æ»¤å’Œç¼©å°å—å½±å“çš„æ¨¡å—åˆ—è¡¨ï¼Œä½¿ HMR æ›´å‡†ç¡®ã€‚</p></li> <li><p>è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œå¹¶é€šè¿‡å‘å®¢æˆ·ç«¯å‘é€è‡ªå®šä¹‰äº‹ä»¶æ¥æ‰§è¡Œå®Œæ•´çš„è‡ªå®šä¹‰ HMR å¤„ç†:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleHotUpdate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> server <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  server<span class="token punctuation">.</span>ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'special-update'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="rollup-é’©å­"><a href="#rollup-é’©å­" class="header-anchor">#</a> Rollup é’©å­</h3> <blockquote><p>è¦è®°ä½ Rollup æ˜¯ä¸€ä¸ªå­˜ç²¹çš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒçš„é’©å­ä¹Ÿåº”è¯¥ä¸æ‰“åŒ…ç›¸å…³ï¼Œæ‰€ä»¥ Rollup é’©å­ç”¨äºé…ç½® &amp; ä¿®æ”¹ Rollup åŸæœ‰çš„æŸäº›é…ç½®æˆ–å…¶ä»–åŠŸèƒ½</p></blockquote> <p>åœ¨å¼€å‘ä¸­ï¼ŒVite å¼€å‘æœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªæ’ä»¶å®¹å™¨æ¥è°ƒç”¨ <a href="https://rollupjs.org/guide/en/#build-hooks" target="_blank" rel="noopener noreferrer">Rollup æ„å»ºé’©å­<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œä¸ Rollup å¦‚å‡ºä¸€è¾™ã€‚</p> <p>ä»¥ä¸‹é’©å­åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼š</p> <ul><li><a href="https://rollupjs.org/guide/en/#options" target="_blank" rel="noopener noreferrer"><code>options</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#buildstart" target="_blank" rel="noopener noreferrer"><code>buildStart</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>ä»¥ä¸‹é’©å­ä¼šåœ¨æ¯ä¸ªä¼ å…¥æ¨¡å—è¯·æ±‚æ—¶è¢«è°ƒç”¨ï¼š</p> <ul><li><a href="https://rollupjs.org/guide/en/#resolveid" target="_blank" rel="noopener noreferrer"><code>resolveId</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#load" target="_blank" rel="noopener noreferrer"><code>load</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#transform" target="_blank" rel="noopener noreferrer"><code>transform</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>ä»¥ä¸‹é’©å­åœ¨æœåŠ¡å™¨å…³é—­æ—¶è¢«è°ƒç”¨ï¼š</p> <ul><li><a href="https://rollupjs.org/guide/en/#buildend" target="_blank" rel="noopener noreferrer"><code>buildEnd</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://rollupjs.org/guide/en/#closebundle" target="_blank" rel="noopener noreferrer"><code>closeBundle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>è¯·æ³¨æ„ <a href="https://rollupjs.org/guide/en/#moduleparsed" target="_blank" rel="noopener noreferrer"><code>moduleParsed</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> é’©å­åœ¨å¼€å‘ä¸­æ˜¯ <strong>ä¸ä¼š</strong> è¢«è°ƒç”¨çš„ï¼Œå› ä¸º Vite ä¸ºäº†æ€§èƒ½ä¼šé¿å…å®Œæ•´çš„ AST è§£æã€‚</p> <p><a href="https://rollupjs.org/guide/en/#output-generation-hooks" target="_blank" rel="noopener noreferrer">Output Generation Hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼ˆé™¤äº† <code>closeBundle</code>) åœ¨å¼€å‘ä¸­æ˜¯ <strong>ä¸ä¼š</strong> è¢«è°ƒç”¨çš„ã€‚ä½ å¯ä»¥è®¤ä¸º Vite çš„å¼€å‘æœåŠ¡å™¨åªè°ƒç”¨äº† <code>rollup.rollup()</code> è€Œæ²¡æœ‰è°ƒç”¨ <code>bundle.generate()</code>ã€‚</p></blockquote> <h3 id="æ’ä»¶é¡ºåº-æƒ…æ™¯åº”ç”¨"><a href="#æ’ä»¶é¡ºåº-æƒ…æ™¯åº”ç”¨" class="header-anchor">#</a> æ’ä»¶é¡ºåº &amp; æƒ…æ™¯åº”ç”¨</h3> <p>ä¸€ä¸ª Vite æ’ä»¶å¯ä»¥é¢å¤–æŒ‡å®šä¸€ä¸ª <code>enforce</code> å±æ€§ï¼ˆç±»ä¼¼äº webpack åŠ è½½å™¨ï¼‰æ¥è°ƒæ•´å®ƒçš„åº”ç”¨é¡ºåºã€‚<code>enforce</code> çš„å€¼å¯ä»¥æ˜¯<code>pre</code> æˆ– <code>post</code>ã€‚è§£æåçš„æ’ä»¶å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ’åˆ—ï¼š</p> <ul><li>Alias</li> <li>å¸¦æœ‰ <code>enforce: 'pre'</code> çš„ç”¨æˆ·æ’ä»¶</li> <li>Vite æ ¸å¿ƒæ’ä»¶</li> <li>æ²¡æœ‰ enforce å€¼çš„ç”¨æˆ·æ’ä»¶</li> <li>Vite æ„å»ºç”¨çš„æ’ä»¶</li> <li>å¸¦æœ‰ <code>enforce: 'post'</code> çš„ç”¨æˆ·æ’ä»¶</li> <li>Vite åç½®æ„å»ºæ’ä»¶ï¼ˆæœ€å°åŒ–ï¼Œmanifestï¼ŒæŠ¥å‘Šï¼‰</li></ul> <hr> <p>é»˜è®¤æƒ…å†µä¸‹æ’ä»¶åœ¨å¼€å‘ï¼ˆserveï¼‰å’Œæ„å»ºï¼ˆbuildï¼‰æ¨¡å¼ä¸­éƒ½ä¼šè°ƒç”¨ã€‚å¦‚æœæ’ä»¶åªéœ€è¦åœ¨é¢„è§ˆæˆ–æ„å»ºæœŸé—´æœ‰æ¡ä»¶åœ°åº”ç”¨ï¼Œè¯·ä½¿ç”¨ <code>apply</code> å±æ€§æŒ‡æ˜å®ƒä»¬ä»…åœ¨ <code>'build'</code> æˆ– <code>'serve'</code> æ¨¡å¼æ—¶è°ƒç”¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;build-only&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æˆ– 'serve'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŒæ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å‡½æ•°æ¥è¿›è¡Œæ›´ç²¾å‡†çš„æ§åˆ¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;build-only&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æˆ– 'serve'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="header-anchor">#</a> æœ€ä½³å®è·µ</h3> <p>Vite æ’ä»¶çš„å®šä¹‰æ–¹å¼å¤šä¸ºä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ï¼Œå¯¹è±¡ä¸­å°†è¢«æ³¨å…¥ Vite ç‰¹æœ‰é’©å­æˆ–å…¨å±€ï¼ˆRollupï¼‰çš„é’©å­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// myPlugin.js</span>

<span class="token comment">// ? å‡è®¾ä½ çš„æ’ä»¶åŒæ—¶éœ€è¦ Rollup é’©å­ä¸ Vite é’©å­ç±»å‹è¡¥å…¨</span>
<span class="token comment">/** @type {(import(&quot;vite&quot;).Plugin | import(&quot;vite&quot;).PluginContainer )}*/</span>
<span class="token comment">// ? å‡è®¾ä½ çš„æ’ä»¶åŒæ—¶åªéœ€è¦ Vite é’©å­ç±»å‹è¡¥å…¨</span>
<span class="token comment">/** @type import(&quot;vite&quot;).Plugin*/</span>
<span class="token comment">// ? å‡è®¾ä½ çš„æ’ä»¶åŒæ—¶åªéœ€è¦ Rollup é’©å­ç±»å‹è¡¥å…¨</span>
<span class="token comment">/** @type import(&quot;vite&quot;).PluginContainer*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">export</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// options ä¸ºè°ƒç”¨æ—¶å¯ä»¥ä¼ å…¥çš„é…ç½®å¯¹è±¡</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ’ä»¶åç§°</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;myPlugin-xxx&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// è®¾ç½®æ’ä»¶æ‰§è¡Œé¡ºåº</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// æ’ä»¶æ‰§è¡Œåœ¨å“ªç§ç¯å¢ƒä¸‹ serve ä¸ºå¼€å‘ç¯å¢ƒ build ä¸ºæ„å»ºç¯å¢ƒ</span>
        <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>
        <span class="token comment">// ä¿®æ”¹æºé…ç½®é’©å­</span>
        <span class="token function">config</span><span class="token punctuation">(</span><span class="token parameter">baseConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">transformIndexHtml</span><span class="token punctuation">(</span><span class="token parameter">baseHtml</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="å¸¸ç”¨æ’ä»¶-æ’ä»¶åŸç†"><a href="#å¸¸ç”¨æ’ä»¶-æ’ä»¶åŸç†" class="header-anchor">#</a> å¸¸ç”¨æ’ä»¶ &amp; æ’ä»¶åŸç†</h2> <p>é™¤äº† vite-aliasesï¼Œè¿˜æœ‰å‡ ä¸ªå¸¸ç”¨ä¸”å®ç”¨çš„å°æ’ä»¶ï¼š</p> <ul><li><p>vite-plugin-htmlï¼šå‘ index.html ä¸­æ³¨å…¥å˜é‡ï¼Œè¿™ä¸ªæ’ä»¶åœ¨æ—©æœŸçš„ vue-cli ä½¿ç”¨è¿‡ã€‚</p> <ul><li>html éœ€è¦ä½¿ç”¨ ejs ï¼ˆ<code>&lt;%= title %&gt;</code>ï¼‰è¯­æ³•æ¥æ”¶ï¼ˆå…¶å®å°±æ˜¯æ›¿æ¢çš„æ“ä½œï¼‰ã€‚</li></ul></li> <li><p>vite-plugin-mock + mock.jsï¼šè‡ªåŠ¨æ‹¦æˆªæœ¬åœ°è¯·æ±‚ï¼Œå¹¶è¿”å› Mock æ•°æ®ã€‚</p></li></ul> <h3 id="vite-plugin-html"><a href="#vite-plugin-html" class="header-anchor">#</a> <em><a href="https://github.com/vbenjs/vite-plugin-html#usage" target="_blank" rel="noopener noreferrer">vite-plugin-html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></h3> <p>é¦–å…ˆä¸‹è½½æ’ä»¶ï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-html <span class="token parameter variable">-D</span>
</code></pre></div><p>ä½¿ç”¨æ’ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-html&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">createHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// data å†…çš„å¯¹è±¡å°†ä¼šè¢«æ³¨å…¥åˆ° html ä¸­ï¼Œhtml éœ€è¦ä½¿ç”¨ ejs è¯­æ³•æ¥æ”¶</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Home - é¦–é¡µ&quot;</span><span class="token punctuation">,</span>
                    <span class="token comment">// types.js æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å­—ä½“åŠ¨ç”»åº“</span>
                    <span class="token literal-property property">injectScript</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://cdn.bootcdn.net/ajax/libs/typed.js/2.0.12/typed.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                    <span class="token literal-property property">slogn</span><span class="token operator">:</span> <span class="token string">&quot;ç”Ÿå‘½ä¸æ¯ï¼Œæˆ˜æ–—ä¸æ­¢&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>html å†…å®¹ï¼š</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%- title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;%- injectScript %&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>&lt;%- slogn %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å¯åŠ¨æœåŠ¡æŸ¥çœ‹æ•ˆæœï¼š</p> <p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301281936355.png" alt="image-20230128193654307"></p> <h3 id="vite-plugin-mock"><a href="#vite-plugin-mock" class="header-anchor">#</a> <em><a href="https://github.com/vbenjs/vite-plugin-mock" target="_blank" rel="noopener noreferrer">vite-plugin-mock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em></h3> <p>è¯¥æ’ä»¶ä¼šè‡ªåŠ¨æ‰«ææ ¹ç›®å½•ä¸‹ mock ç›®å½•ä¸‹çš„ index.js çš„è¿”å›å€¼ï¼Œéšåç›‘å¬å¹¶æ‹¦æˆªæœ¬åœ°è¯·æ±‚ï¼Œæ—©æœ€åè¿”å› index.js ä¸‹çš„æŒ‡å®šå†…å®¹ï¼Œ<strong>å¿…é¡»</strong>é…åˆ mock.js ä½¿ç”¨ã€‚</p> <p>é¦–å…ˆä¸‹è½½æ’ä»¶ä¸ mockjsï¼š</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> vite-plugin-mock mockjs <span class="token parameter variable">-D</span>
</code></pre></div><p>éšååœ¨æ ¹ç›®å½•ä¸‹å®šä¹‰ mock ç›®å½•å®šä¹‰ä¸€ä¸ª Index.js æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¯¥æ–‡ä»¶æ˜¯è¢«æ’ä»¶åœ¨ node ç¯å¢ƒä¸‹è¯»å–çš„ï¼Œæ‰€ä»¥å®šä¹‰ä¸º commonJs è§„èŒƒ</span>
<span class="token comment">// å…³äºæ­¤æ–‡ä»¶çš„æ ‡å‡†æ ¼å¼ï¼Œå¯å‰å¾€å®˜ç½‘æŸ¥çœ‹ ~&gt; https://github.com/vbenjs/vite-plugin-mock#mock-file-example</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/api/user&quot;</span><span class="token punctuation">,</span>
        <span class="token function">response</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> body <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">&quot;done&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;å¤§å®&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>æœ€ååœ¨ vite.config.js ä¸­å¯ç”¨æ’ä»¶ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> viteMockServe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-mock&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).UserConfig */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">viteMockServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// ä»¥ä¸‹ä¸ºé»˜è®¤é…ç½®</span>
            <span class="token literal-property property">mockPath</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">localEnabled</span><span class="token operator">:</span> command <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>é…ç½®å¥½åæˆ‘ä»¬å¯ä»¥åœ¨ main.js ä¸­ fetch ä¸€ä¸‹æŸ¥çœ‹ç»“æœï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/api/user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://sbr-1314368469.cos.ap-guangzhou.myqcloud.com/Images/202301282103099.png" alt="image-20230128210351050"></p> <h3 id="æ’ä»¶å¤§è‡´åŸç†"><a href="#æ’ä»¶å¤§è‡´åŸç†" class="header-anchor">#</a> æ’ä»¶å¤§è‡´åŸç†</h3> <p><strong>vite-plugin-html æ’ä»¶å¤§è‡´åŸç†ï¼š</strong></p> <ul><li>ä½¿ç”¨ <em>transformIndexHtml</em> é’©å­é€šè¿‡æ­£åˆ™åŒ¹é…æ›¿æ¢æ‰æŒ‡å®šçš„ key å€¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é’©å­è¿è¡Œçš„æ—¶æœºã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite-plugin-my-transfrom-html.js</span>

<span class="token comment">/** @type import(&quot;vite&quot;).Plugin*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// å°†è¿™ä¸ªã€æ’ä»¶ã€‘çš„è°ƒç”¨æ—¶æœºå¾€å‰è°ƒï¼Œéå¿…é¡»</span>
    <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">transformIndexHtml</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°†è¿™ä¸ªã€é’©å­ã€‘çš„è°ƒç”¨æ—¶æœºå¾€å‰è°ƒ</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å¿…é¡»å¡« pre èµ¶åœ¨æ ¸å¿ƒæ’ä»¶æ¸²æŸ“ html å‰ä¿®æ”¹ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span>
        <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">baseHtml</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;%[-=] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> %&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                baseHtml <span class="token operator">=</span> baseHtml<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> baseHtml<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>vite-plugin-mock æ’ä»¶å¤§è‡´åŸç†ï¼š</strong></p> <ul><li>ä½¿ç”¨ <em>configureServer</em> é’©å­</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite-plugin-my-mock.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> statSync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** @type import(&quot;vite&quot;).Plugin*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;vite-plugin-my-mock&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">apply</span><span class="token operator">:</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>
    <span class="token function">configureServer</span><span class="token punctuation">(</span><span class="token parameter">_server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/** @type import(&quot;vite&quot;).ViteDevServer */</span>
        <span class="token keyword">const</span> server <span class="token operator">=</span> _server<span class="token punctuation">;</span>
        <span class="token keyword">const</span> mockData <span class="token operator">=</span> <span class="token function">getMockDataSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// server.middlewares å³ ViteDevServer æœåŠ¡å™¨çš„ä¸­é—´ä»¶ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè§¦å‘è¿™ä¸ªä¸­é—´ä»¶</span>
        <span class="token comment">// æˆ‘ä»¬å°±åœ¨è¿™é‡ŒæŸ¥çœ‹æ¯æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦æ‹¦æˆª</span>
        server<span class="token punctuation">.</span>middlewares<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> mockItem <span class="token operator">=</span> mockData<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token operator">?.</span>url <span class="token operator">===</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¦‚æœè¯·æ±‚ä¸­çš„ url ä¸­åŒ…å« mockdata ä¸­çš„ urlï¼Œé‚£ä¹ˆæ‹¦æˆªä»–ï¼ˆä¸ next æ”¾è¡Œ ï¼‰</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mockItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ‰§è¡Œ mockitem çš„ response æ–¹æ³•ï¼Œå¿…é¡»ä¼ å…¥ req è¯·æ±‚ä½“ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ˆè¿™ä¸€æ­¥æ˜¯åœ¨æ¨¡æ‹Ÿè¯·æ±‚è·å–æ•°æ®ï¼‰</span>
                <span class="token keyword">const</span> interceptData <span class="token operator">=</span> mockItem<span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// éšåè®¾ç½®å“åº”ä½“çš„æ ¼å¼ä¸º json ä¸ç„¶æœåŠ¡å™¨ä¼šä»¥ä¸ºæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯¼è‡´ä¹±ç </span>
                res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>interceptData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ— å…³è¯·æ±‚ç›´æ¥æ”¾è¡Œ</span>
                <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @returns {Array}
 */</span>
<span class="token keyword">function</span> <span class="token function">getMockDataSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æœ€åè°ƒç”¨è¿™ä¸ªæ–‡ä»¶çš„å°†æ˜¯ vite.config.js é‚£ä¹ˆ process.cwd() å°±æ˜¯æ ¹ç›®å½•</span>
    <span class="token keyword">const</span> mockPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> mockStat <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span>mockPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mockStat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> indexPath <span class="token operator">=</span> mockPath <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/index.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token comment">// åŒæ­¥åŠ è½½æ–‡ä»¶è·å–æ•°æ®</span>
        result <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>indexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>vite-plugin-aliases æ’ä»¶å¤§è‡´åŸç†ï¼š</strong></p> <ul><li>é€šè¿‡ node æ¨¡å—è¯»å–æŒ‡å®šç›®å½•ï¼Œå†æ ¹æ®æ–‡ä»¶å±æ€§åˆ›å»ºåˆæ³•çš„é…ç½®å¯¹è±¡ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vite-plugin-my-create-aliases.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> statSync<span class="token punctuation">,</span> readdirSync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// é»˜è®¤å‰ç¼€</span>
    <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// é»˜è®¤æ‰«æç›®å½•</span>
    <span class="token literal-property property">scan</span><span class="token operator">:</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ CommonJS è§„èŒƒ</span>
<span class="token comment">/** @type import(&quot;vite&quot;).Plugin*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> scan<span class="token punctuation">,</span> prefix <span class="token operator">=</span> defaultOptions<span class="token punctuation">.</span>prefix <span class="token punctuation">}</span> <span class="token operator">=</span> defaultOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;vite-plugin-my-createA-liases&quot;</span><span class="token punctuation">,</span>
    <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> scanPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scan <span class="token operator">||</span> <span class="token string">&quot;src&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">createAliasTree</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> scanPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">alias</span><span class="token operator">:</span> result<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @param {string} prefix
 * @param {string} byPath
 * @returns {Object}
 */</span>
<span class="token keyword">function</span> <span class="token function">createAliasTree</span><span class="token punctuation">(</span><span class="token parameter">prefix<span class="token punctuation">,</span> byPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> folderTree <span class="token operator">=</span> <span class="token function">readdirSync</span><span class="token punctuation">(</span>byPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> folderName <span class="token keyword">of</span> folderTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src&quot;</span><span class="token punctuation">,</span> folderName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// statSync è¿”å›ä¸€ä¸ªæ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯</span>
        <span class="token keyword">const</span> stat <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outName <span class="token operator">=</span> prefix <span class="token operator">+</span> folderName<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">[</span>outName<span class="token punctuation">]</span> <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id=""><a href="#" class="header-anchor">#</a></h2></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#å…³äºæ’ä»¶-plugin" title="å…³äºæ’ä»¶ Plugin">å…³äºæ’ä»¶ Plugin</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#çº¦å®š" title="çº¦å®š">çº¦å®š</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#æ’ä»¶-api" title="æ’ä»¶ API">æ’ä»¶ API</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#vite-é’©å­" title="Vite é’©å­">Vite é’©å­</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#rollup-é’©å­" title="Rollup é’©å­">Rollup é’©å­</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#æ’ä»¶é¡ºåº-æƒ…æ™¯åº”ç”¨" title="æ’ä»¶é¡ºåº &amp; æƒ…æ™¯åº”ç”¨">æ’ä»¶é¡ºåº &amp; æƒ…æ™¯åº”ç”¨</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#æœ€ä½³å®è·µ" title="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#å¸¸ç”¨æ’ä»¶-æ’ä»¶åŸç†" title="å¸¸ç”¨æ’ä»¶ &amp; æ’ä»¶åŸç†">å¸¸ç”¨æ’ä»¶ &amp; æ’ä»¶åŸç†</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#vite-plugin-html" title="vite-plugin-html">vite-plugin-html</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#vite-plugin-mock" title="vite-plugin-mock">vite-plugin-mock</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#æ’ä»¶å¤§è‡´åŸç†" title="æ’ä»¶å¤§è‡´åŸç†">æ’ä»¶å¤§è‡´åŸç†</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#" title=""></a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/bigRiceRice" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>è¯¥ç½‘ç«™ä½¿ç”¨ vuepress + @vuepress/theme-blog æ­å»º â€”â€” by: Big Rice Â© 2023</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.52271ad8.js" defer></script><script src="/blog/assets/js/6.4adeed80.js" defer></script><script src="/blog/assets/js/3.606773b1.js" defer></script><script src="/blog/assets/js/94.d6f1a328.js" defer></script>
  </body>
</html>
